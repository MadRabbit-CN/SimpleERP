<html>
<head>
<title>bootstrap.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #60ff60;}
.s1 { color: #d8d8d8;}
.s2 { color: #d8d8d8;}
.s3 { color: #ffa0a0;}
.s4 { color: #757575;}
.s5 { color: #0000ff;}
.s6 { color: #808080; font-style: italic;}
.ln { color: #555753; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#000000">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
bootstrap.js</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">var </span><span class="s1">Ext </span><span class="s2">= </span><span class="s1">Ext </span><span class="s2">|| {};</span>
<span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">|| </span><span class="s3">&quot;bootstrap.json&quot;</span><span class="s2">;</span>
<span class="s4">// @tag core</span>
// @define Ext.Boot

<span class="s0">var </span><span class="s1">Ext </span><span class="s2">= </span><span class="s1">Ext </span><span class="s2">|| {};</span>

<span class="s4">//&lt;editor-fold desc=&quot;Boot&quot;&gt;</span>
/**
 * @class Ext.Boot
 * @singleton
 * @private
 */
<span class="s1">Ext</span><span class="s2">.</span><span class="s1">Boot </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">Boot </span><span class="s2">|| (</span><span class="s0">function </span><span class="s2">(</span><span class="s1">emptyFn</span><span class="s2">) {</span>

    <span class="s0">var </span><span class="s1">doc </span><span class="s2">= </span><span class="s1">document</span><span class="s2">,</span>
        <span class="s1">_emptyArray </span><span class="s2">= [],</span>
        <span class="s1">_config </span><span class="s2">= {</span>
            <span class="s4">/**</span>
             * @cfg {Boolean} [disableCaching=true]
             * If `true` current timestamp is added to script URL's to prevent caching.
             * In debug builds, adding a &quot;cache&quot; or &quot;disableCacheBuster&quot; query parameter
             * to the page's URL will set this to `false`.
             */
            <span class="s1">disableCaching</span><span class="s2">: (</span><span class="s5">/[?&amp;](?:cache|disableCacheBuster)\b/i</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">location</span><span class="s2">.</span><span class="s1">search</span><span class="s2">) ||</span>
                !(<span class="s5">/http[s]?\:/i</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">location</span><span class="s2">.</span><span class="s1">href</span><span class="s2">)) ||</span>
                <span class="s5">/(^|[ ;])ext-cache=1/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">doc</span><span class="s2">.</span><span class="s1">cookie</span><span class="s2">)) ? </span><span class="s0">false </span><span class="s2">:</span>
                <span class="s0">true</span><span class="s2">,</span>

            <span class="s4">/**</span>
             * @cfg {String} [disableCachingParam=&quot;_dc&quot;]
             * The query parameter name for the cache buster's timestamp.
             */
            <span class="s1">disableCachingParam</span><span class="s2">: </span><span class="s3">'_dc'</span><span class="s2">,</span>

            <span class="s4">/**</span>
             * @cfg {Boolean} loadDelay
             * Millisecond delay between asynchronous script injection (prevents stack
             * overflow on some user agents) 'false' disables delay but potentially
             * increases stack load.
             */
            <span class="s1">loadDelay</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>

            <span class="s4">/**</span>
             * @cfg {Boolean} preserveScripts
             * `false` to remove asynchronously loaded scripts, `true` to retain script
             * element for browser debugger compatibility and improved load performance.
             */
            <span class="s1">preserveScripts</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>

            <span class="s4">/**</span>
             * @cfg {String} [charset=UTF-8]
             * Optional charset to specify encoding of dynamic content.
             */
            <span class="s1">charset</span><span class="s2">: </span><span class="s3">'UTF-8'</span>
        <span class="s2">},</span>

        <span class="s1">_assetConfig</span><span class="s2">= {},</span>

        <span class="s1">cssRe </span><span class="s2">= </span><span class="s5">/\.css(?:\?|$)/i</span><span class="s2">,</span>
        <span class="s1">resolverEl </span><span class="s2">= </span><span class="s1">doc</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s3">'a'</span><span class="s2">),</span>
        <span class="s1">isBrowser </span><span class="s2">= </span><span class="s0">typeof </span><span class="s1">window </span><span class="s2">!== </span><span class="s3">'undefined'</span><span class="s2">,</span>
        <span class="s1">_environment </span><span class="s2">= {</span>
            <span class="s1">browser</span><span class="s2">: </span><span class="s1">isBrowser</span><span class="s2">,</span>
            <span class="s1">node</span><span class="s2">: !</span><span class="s1">isBrowser </span><span class="s2">&amp;&amp; (</span><span class="s0">typeof </span><span class="s1">require </span><span class="s2">=== </span><span class="s3">'function'</span><span class="s2">),</span>
            <span class="s1">phantom</span><span class="s2">: (</span><span class="s1">window </span><span class="s2">&amp;&amp; (</span><span class="s1">window</span><span class="s2">.</span><span class="s1">_phantom </span><span class="s2">|| </span><span class="s1">window</span><span class="s2">.</span><span class="s1">callPhantom</span><span class="s2">)) || </span><span class="s5">/PhantomJS/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">window</span><span class="s2">.</span><span class="s1">navigator</span><span class="s2">.</span><span class="s1">userAgent</span><span class="s2">)</span>
        },
        <span class="s1">_tags </span><span class="s2">= (</span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">platformTags </span><span class="s2">= {}),</span>

        <span class="s4">// All calls to _debug are commented out to speed up old browsers a bit;</span>
        // yes that makes a difference because the cost of concatenating strings
        // and passing them into _debug() adds up pretty quickly.
        <span class="s1">_debug </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">message</span><span class="s2">) {</span>
            <span class="s4">//console.log(message);</span>
        <span class="s2">},</span>
        <span class="s1">_apply </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">config</span><span class="s2">, </span><span class="s1">defaults</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">defaults</span><span class="s2">) {</span>
                <span class="s1">_apply</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">defaults</span><span class="s2">);</span>
            }
            <span class="s0">if </span><span class="s2">(</span><span class="s1">object </span><span class="s2">&amp;&amp; </span><span class="s1">config </span><span class="s2">&amp;&amp; </span><span class="s0">typeof </span><span class="s1">config </span><span class="s2">=== </span><span class="s3">'object'</span><span class="s2">) {</span>
                <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">i </span><span class="s0">in </span><span class="s1">config</span><span class="s2">) {</span>
                    <span class="s1">object</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">config</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                }
            }
            <span class="s0">return </span><span class="s1">object</span><span class="s2">;</span>
        },
        <span class="s1">_merge </span><span class="s2">= </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">lowerCase </span><span class="s2">= </span><span class="s0">false</span><span class="s2">,</span>
                <span class="s1">obj </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">),</span>
                <span class="s1">index</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">value</span><span class="s2">;</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">arguments</span><span class="s2">[</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s3">1</span><span class="s2">] === </span><span class="s3">'boolean'</span><span class="s2">) {</span>
                <span class="s1">lowerCase </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">);</span>
            }

            <span class="s1">len </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">index</span><span class="s2">++) {</span>
                <span class="s1">value </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">value </span><span class="s2">=== </span><span class="s3">'object'</span><span class="s2">) {</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s0">in </span><span class="s1">value</span><span class="s2">) {</span>
                        <span class="s1">obj</span><span class="s2">[</span><span class="s1">lowerCase </span><span class="s2">? </span><span class="s1">i</span><span class="s2">.</span><span class="s1">toLowerCase</span><span class="s2">() : </span><span class="s1">i</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                    }
                }
            }

            <span class="s0">return </span><span class="s1">obj</span><span class="s2">;</span>
        },
        <span class="s1">_getKeys </span><span class="s2">= (</span><span class="s0">typeof </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys </span><span class="s2">== </span><span class="s3">'function'</span><span class="s2">) ?</span>
            <span class="s0">function</span><span class="s2">(</span><span class="s1">object</span><span class="s2">){</span>
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">object</span><span class="s2">) {</span>
                    <span class="s0">return </span><span class="s2">[];</span>
                }
                <span class="s0">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">object</span><span class="s2">);</span>
            } :
            <span class="s0">function</span><span class="s2">(</span><span class="s1">object</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">keys </span><span class="s2">= [],</span>
                    <span class="s1">property</span><span class="s2">;</span>

                <span class="s0">for </span><span class="s2">(</span><span class="s1">property </span><span class="s0">in </span><span class="s1">object</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">object</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s1">property</span><span class="s2">)) {</span>
                        <span class="s1">keys</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">property</span><span class="s2">);</span>
                    }
                }

                <span class="s0">return </span><span class="s1">keys</span><span class="s2">;</span>
            },
    <span class="s6">/* 
<a name="l2"><span class="ln">2    </span></a>     * The Boot loader class manages Request objects that contain one or 
<a name="l3"><span class="ln">3    </span></a>     * more individual urls that need to be loaded.  Requests can be performed 
<a name="l4"><span class="ln">4    </span></a>     * synchronously or asynchronously, but will always evaluate urls in the 
<a name="l5"><span class="ln">5    </span></a>     * order specified on the request object. 
<a name="l6"><span class="ln">6    </span></a>     */</span>
        <span class="s1">Boot </span><span class="s2">= {</span>
            <span class="s1">loading</span><span class="s2">: </span><span class="s3">0</span><span class="s2">,</span>
            <span class="s1">loaded</span><span class="s2">: </span><span class="s3">0</span><span class="s2">,</span>
            <span class="s1">apply</span><span class="s2">: </span><span class="s1">_apply</span><span class="s2">,</span>
            <span class="s1">env</span><span class="s2">: </span><span class="s1">_environment</span><span class="s2">,</span>
            <span class="s1">config</span><span class="s2">: </span><span class="s1">_config</span><span class="s2">,</span>

            <span class="s4">/**</span>
             * @cfg {Object} assetConfig
             * A map (url-&gt;assetConfig) that contains information about assets loaded by the Microlaoder.
             */
            <span class="s1">assetConfig</span><span class="s2">: </span><span class="s1">_assetConfig</span><span class="s2">,</span>

            <span class="s4">// Keyed by absolute URL this object holds &quot;true&quot; if that URL is already loaded</span>
            // or an array of callbacks to call once it loads.
            <span class="s1">scripts</span><span class="s2">: {</span>
                <span class="s6">/* 
<a name="l7"><span class="ln">7    </span></a>                 Entry objects 
<a name="l8"><span class="ln">8    </span></a> 
<a name="l9"><span class="ln">9    </span></a>                 'http://foo.com/bar/baz/Thing.js': { 
<a name="l10"><span class="ln">10   </span></a>                 done: true, 
<a name="l11"><span class="ln">11   </span></a>                 el: scriptEl || linkEl, 
<a name="l12"><span class="ln">12   </span></a>                 preserve: true, 
<a name="l13"><span class="ln">13   </span></a>                 requests: [ request1, ... ] 
<a name="l14"><span class="ln">14   </span></a>                 } 
<a name="l15"><span class="ln">15   </span></a>                 */</span>
            <span class="s2">},</span>

            <span class="s4">/**</span>
             * contains the current script name being loaded
             * (loadSync or sequential load only)
             */
            <span class="s1">currentFile</span><span class="s2">: </span><span class="s0">null</span><span class="s2">,</span>
            <span class="s1">suspendedQueue</span><span class="s2">: [],</span>
            <span class="s1">currentRequest</span><span class="s2">: </span><span class="s0">null</span><span class="s2">,</span>

            <span class="s4">// when loadSync is called, need to cause subsequent load requests to also be loadSync,</span>
            // eg, when Ext.require(...) is called
            <span class="s1">syncMode</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>

            <span class="s6">/* 
<a name="l16"><span class="ln">16   </span></a>             * simple helper method for debugging 
<a name="l17"><span class="ln">17   </span></a>             */</span>
            <span class="s1">debug</span><span class="s2">: </span><span class="s1">_debug</span><span class="s2">,</span>

            <span class="s4">/**</span>
             * enables / disables loading scripts via script / link elements rather
             * than using ajax / eval
             */
            <span class="s1">useElements</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>

            <span class="s1">listeners</span><span class="s2">: [],</span>

            <span class="s1">Request</span><span class="s2">: </span><span class="s1">Request</span><span class="s2">,</span>

            <span class="s1">Entry</span><span class="s2">: </span><span class="s1">Entry</span><span class="s2">,</span>

            <span class="s1">allowMultipleBrowsers</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>

            <span class="s1">browserNames</span><span class="s2">: {</span>
                <span class="s1">ie</span><span class="s2">: </span><span class="s3">'IE'</span><span class="s2">,</span>
                <span class="s1">firefox</span><span class="s2">: </span><span class="s3">'Firefox'</span><span class="s2">,</span>
                <span class="s1">safari</span><span class="s2">: </span><span class="s3">'Safari'</span><span class="s2">,</span>
                <span class="s1">chrome</span><span class="s2">: </span><span class="s3">'Chrome'</span><span class="s2">,</span>
                <span class="s1">opera</span><span class="s2">: </span><span class="s3">'Opera'</span><span class="s2">,</span>
                <span class="s1">dolfin</span><span class="s2">: </span><span class="s3">'Dolfin'</span><span class="s2">,</span>
                <span class="s1">edge</span><span class="s2">: </span><span class="s3">'Edge'</span><span class="s2">,</span>
                <span class="s1">webosbrowser</span><span class="s2">: </span><span class="s3">'webOSBrowser'</span><span class="s2">,</span>
                <span class="s1">chromeMobile</span><span class="s2">: </span><span class="s3">'ChromeMobile'</span><span class="s2">,</span>
                <span class="s1">chromeiOS</span><span class="s2">: </span><span class="s3">'ChromeiOS'</span><span class="s2">,</span>
                <span class="s1">silk</span><span class="s2">: </span><span class="s3">'Silk'</span><span class="s2">,</span>
                <span class="s1">other</span><span class="s2">: </span><span class="s3">'Other'</span>
            <span class="s2">},</span>

            <span class="s1">osNames</span><span class="s2">: {</span>
                <span class="s1">ios</span><span class="s2">: </span><span class="s3">'iOS'</span><span class="s2">,</span>
                <span class="s1">android</span><span class="s2">: </span><span class="s3">'Android'</span><span class="s2">,</span>
                <span class="s1">windowsPhone</span><span class="s2">: </span><span class="s3">'WindowsPhone'</span><span class="s2">,</span>
                <span class="s1">webos</span><span class="s2">: </span><span class="s3">'webOS'</span><span class="s2">,</span>
                <span class="s1">blackberry</span><span class="s2">: </span><span class="s3">'BlackBerry'</span><span class="s2">,</span>
                <span class="s1">rimTablet</span><span class="s2">: </span><span class="s3">'RIMTablet'</span><span class="s2">,</span>
                <span class="s1">mac</span><span class="s2">: </span><span class="s3">'MacOS'</span><span class="s2">,</span>
                <span class="s1">win</span><span class="s2">: </span><span class="s3">'Windows'</span><span class="s2">,</span>
                <span class="s1">tizen</span><span class="s2">: </span><span class="s3">'Tizen'</span><span class="s2">,</span>
                <span class="s1">linux</span><span class="s2">: </span><span class="s3">'Linux'</span><span class="s2">,</span>
                <span class="s1">bada</span><span class="s2">: </span><span class="s3">'Bada'</span><span class="s2">,</span>
                <span class="s1">chromeOS</span><span class="s2">: </span><span class="s3">'ChromeOS'</span><span class="s2">,</span>
                <span class="s1">other</span><span class="s2">: </span><span class="s3">'Other'</span>
            <span class="s2">},</span>

            <span class="s1">browserPrefixes</span><span class="s2">: {</span>
                <span class="s1">ie</span><span class="s2">: </span><span class="s3">'MSIE '</span><span class="s2">,</span>
                <span class="s1">edge</span><span class="s2">: </span><span class="s3">'Edge/'</span><span class="s2">,</span>
                <span class="s1">firefox</span><span class="s2">: </span><span class="s3">'Firefox/'</span><span class="s2">,</span>
                <span class="s1">chrome</span><span class="s2">: </span><span class="s3">'Chrome/'</span><span class="s2">,</span>
                <span class="s1">safari</span><span class="s2">: </span><span class="s3">'Version/'</span><span class="s2">,</span>
                <span class="s1">opera</span><span class="s2">: </span><span class="s3">'OPR/'</span><span class="s2">,</span>
                <span class="s1">dolfin</span><span class="s2">: </span><span class="s3">'Dolfin/'</span><span class="s2">,</span>
                <span class="s1">webosbrowser</span><span class="s2">: </span><span class="s3">'wOSBrowser/'</span><span class="s2">,</span>
                <span class="s1">chromeMobile</span><span class="s2">: </span><span class="s3">'CrMo/'</span><span class="s2">,</span>
                <span class="s1">chromeiOS</span><span class="s2">: </span><span class="s3">'CriOS/'</span><span class="s2">,</span>
                <span class="s1">silk</span><span class="s2">: </span><span class="s3">'Silk/'</span>
            <span class="s2">},</span>

            <span class="s4">// When a UA reports multiple browsers this list is used to prioritize the 'real' browser</span>
            // lower index number will win
            <span class="s1">browserPriority</span><span class="s2">: [</span>
                <span class="s3">'edge'</span><span class="s2">,</span>
                <span class="s3">'opera'</span><span class="s2">,</span>
                <span class="s3">'dolfin'</span><span class="s2">,</span>
                <span class="s3">'webosbrowser'</span><span class="s2">,</span>
                <span class="s3">'silk'</span><span class="s2">,</span>
                <span class="s3">'chromeiOS'</span><span class="s2">,</span>
                <span class="s3">'chromeMobile'</span><span class="s2">,</span>
                <span class="s3">'ie'</span><span class="s2">,</span>
                <span class="s3">'firefox'</span><span class="s2">,</span>
                <span class="s3">'safari'</span><span class="s2">,</span>
                <span class="s3">'chrome'</span>
            <span class="s2">],</span>

            <span class="s1">osPrefixes</span><span class="s2">: {</span>
                <span class="s1">tizen</span><span class="s2">: </span><span class="s3">'(Tizen )'</span><span class="s2">,</span>
                <span class="s1">ios</span><span class="s2">: </span><span class="s3">'i(?:Pad|Phone|Pod)(?:.*)CPU(?: iPhone)? OS '</span><span class="s2">,</span>
                <span class="s1">android</span><span class="s2">: </span><span class="s3">'(Android |HTC_|Silk/)'</span><span class="s2">, </span><span class="s4">// Some HTC devices ship with an OSX userAgent by default,</span>
                // so we need to add a direct check for HTC_
                <span class="s1">windowsPhone</span><span class="s2">: </span><span class="s3">'Windows Phone '</span><span class="s2">,</span>
                <span class="s1">blackberry</span><span class="s2">: </span><span class="s3">'(?:BlackBerry|BB)(?:.*)Version\/'</span><span class="s2">,</span>
                <span class="s1">rimTablet</span><span class="s2">: </span><span class="s3">'RIM Tablet OS '</span><span class="s2">,</span>
                <span class="s1">webos</span><span class="s2">: </span><span class="s3">'(?:webOS|hpwOS)\/'</span><span class="s2">,</span>
                <span class="s1">bada</span><span class="s2">: </span><span class="s3">'Bada\/'</span><span class="s2">,</span>
                <span class="s1">chromeOS</span><span class="s2">: </span><span class="s3">'CrOS '</span>
            <span class="s2">},</span>

            <span class="s1">fallbackOSPrefixes</span><span class="s2">: {</span>
                <span class="s1">windows</span><span class="s2">: </span><span class="s3">'win'</span><span class="s2">,</span>
                <span class="s1">mac</span><span class="s2">: </span><span class="s3">'mac'</span><span class="s2">,</span>
                <span class="s1">linux</span><span class="s2">: </span><span class="s3">'linux'</span>
            <span class="s2">},</span>

            <span class="s1">devicePrefixes</span><span class="s2">: {</span>
                <span class="s1">iPhone</span><span class="s2">: </span><span class="s3">'iPhone'</span><span class="s2">,</span>
                <span class="s1">iPod</span><span class="s2">: </span><span class="s3">'iPod'</span><span class="s2">,</span>
                <span class="s1">iPad</span><span class="s2">: </span><span class="s3">'iPad'</span>
            <span class="s2">},</span>

            <span class="s1">maxIEVersion</span><span class="s2">: </span><span class="s3">12</span><span class="s2">,</span>


            <span class="s4">/**</span>
             * The default function that detects various platforms and sets tags
             * in the platform map accordingly.  Examples are iOS, android, tablet, etc.
             * @param tags the set of tags to populate
             */
            <span class="s1">detectPlatformTags</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                    <span class="s1">ua </span><span class="s2">= </span><span class="s1">navigator</span><span class="s2">.</span><span class="s1">userAgent</span><span class="s2">,</span>
                    <span class="s1">isMobile </span><span class="s2">= </span><span class="s5">/Mobile(\/|\s)/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">),</span>
                    <span class="s1">element </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s3">'div'</span><span class="s2">),</span>
                    <span class="s1">isEventSupported </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">) {</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">tag </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
                            <span class="s1">tag </span><span class="s2">= </span><span class="s1">window</span><span class="s2">;</span>
                        }

                        <span class="s0">var </span><span class="s1">eventName </span><span class="s2">= </span><span class="s3">'on' </span><span class="s2">+ </span><span class="s1">name</span><span class="s2">.</span><span class="s1">toLowerCase</span><span class="s2">(),</span>
                            <span class="s1">isSupported </span><span class="s2">= (</span><span class="s1">eventName </span><span class="s0">in </span><span class="s1">element</span><span class="s2">);</span>

                        <span class="s0">if </span><span class="s2">(!</span><span class="s1">isSupported</span><span class="s2">) {</span>
                            <span class="s0">if </span><span class="s2">(</span><span class="s1">element</span><span class="s2">.</span><span class="s1">setAttribute </span><span class="s2">&amp;&amp; </span><span class="s1">element</span><span class="s2">.</span><span class="s1">removeAttribute</span><span class="s2">) {</span>
                                <span class="s1">element</span><span class="s2">.</span><span class="s1">setAttribute</span><span class="s2">(</span><span class="s1">eventName</span><span class="s2">, </span><span class="s3">''</span><span class="s2">);</span>
                                <span class="s1">isSupported </span><span class="s2">= </span><span class="s0">typeof </span><span class="s1">element</span><span class="s2">[</span><span class="s1">eventName</span><span class="s2">] === </span><span class="s3">'function'</span><span class="s2">;</span>

                                <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">element</span><span class="s2">[</span><span class="s1">eventName</span><span class="s2">] !== </span><span class="s3">'undefined'</span><span class="s2">) {</span>
                                    <span class="s1">element</span><span class="s2">[</span><span class="s1">eventName</span><span class="s2">] = </span><span class="s1">undefined</span><span class="s2">;</span>
                                }

                                <span class="s1">element</span><span class="s2">.</span><span class="s1">removeAttribute</span><span class="s2">(</span><span class="s1">eventName</span><span class="s2">);</span>
                            }
                        }

                        <span class="s0">return </span><span class="s1">isSupported</span><span class="s2">;</span>
                    },

                    <span class="s4">// Browser Detection</span>
                    <span class="s1">getBrowsers </span><span class="s2">= </span><span class="s0">function </span><span class="s2">() {</span>
                        <span class="s0">var </span><span class="s1">browsers </span><span class="s2">= {},</span>
                            <span class="s1">maxIEVersion</span><span class="s2">, </span><span class="s1">prefix</span><span class="s2">,</span>
                            <span class="s1">value</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">version</span><span class="s2">, </span><span class="s1">matched</span><span class="s2">;</span>

                        <span class="s4">// MS Edge browser (and possibly others) can report multiple browsers in the UserAgent</span>
                        // &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.10240&quot;
                        // we use this to prioritize the actual browser in this situation
                        <span class="s1">len </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">browserPriority</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                        <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">index</span><span class="s2">++) {</span>
                            <span class="s1">key </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">browserPriority</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                            <span class="s0">if </span><span class="s2">(!</span><span class="s1">matched</span><span class="s2">) {</span>
                                <span class="s1">value </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">browserPrefixes</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
                                <span class="s1">match </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">'(' </span><span class="s2">+ </span><span class="s1">value </span><span class="s2">+ </span><span class="s3">')([\\w\\._]+)'</span><span class="s2">));</span>
                                <span class="s1">version </span><span class="s2">= </span><span class="s1">match </span><span class="s2">&amp;&amp; </span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">1 </span><span class="s2">? </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">match</span><span class="s2">[</span><span class="s3">2</span><span class="s2">]) : </span><span class="s3">0</span><span class="s2">;</span>
                                <span class="s0">if </span><span class="s2">(</span><span class="s1">version</span><span class="s2">) {</span>
                                    <span class="s1">matched </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                                }
                            } <span class="s0">else </span><span class="s2">{</span>
                                <span class="s1">version </span><span class="s2">= </span><span class="s3">0</span><span class="s2">;</span>
                            }
                            <span class="s1">browsers</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">version</span><span class="s2">;</span>
                        }

                        <span class="s4">//Deal with IE document mode</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">browsers</span><span class="s2">.</span><span class="s1">ie</span><span class="s2">) {</span>
                            <span class="s0">var </span><span class="s1">mode </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">documentMode</span><span class="s2">;</span>

                            <span class="s0">if </span><span class="s2">(</span><span class="s1">mode </span><span class="s2">&gt;= </span><span class="s3">8</span><span class="s2">) {</span>
                                <span class="s1">browsers</span><span class="s2">.</span><span class="s1">ie </span><span class="s2">= </span><span class="s1">mode</span><span class="s2">;</span>
                            }
                        }

                        <span class="s4">// Fancy IE greater than and less then quick tags</span>
                        <span class="s1">version </span><span class="s2">= </span><span class="s1">browsers</span><span class="s2">.</span><span class="s1">ie </span><span class="s2">|| </span><span class="s0">false</span><span class="s2">;</span>
                        <span class="s1">maxIEVersion </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s1">version</span><span class="s2">, </span><span class="s1">me</span><span class="s2">.</span><span class="s1">maxIEVersion</span><span class="s2">);</span>

                        <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s2">= </span><span class="s3">8</span><span class="s2">; </span><span class="s1">index </span><span class="s2">&lt;= </span><span class="s1">maxIEVersion</span><span class="s2">; ++</span><span class="s1">index</span><span class="s2">) {</span>
                            <span class="s1">prefix </span><span class="s2">= </span><span class="s3">'ie' </span><span class="s2">+ </span><span class="s1">index</span><span class="s2">;</span>
                            <span class="s1">browsers</span><span class="s2">[</span><span class="s1">prefix </span><span class="s2">+ </span><span class="s3">'m'</span><span class="s2">] = </span><span class="s1">version </span><span class="s2">? </span><span class="s1">version </span><span class="s2">&lt;= </span><span class="s1">index </span><span class="s2">: </span><span class="s3">0</span><span class="s2">;</span>
                            <span class="s1">browsers</span><span class="s2">[</span><span class="s1">prefix</span><span class="s2">] = </span><span class="s1">version </span><span class="s2">? </span><span class="s1">version </span><span class="s2">=== </span><span class="s1">index </span><span class="s2">: </span><span class="s3">0</span><span class="s2">;</span>
                            <span class="s1">browsers</span><span class="s2">[</span><span class="s1">prefix </span><span class="s2">+ </span><span class="s3">'p'</span><span class="s2">] = </span><span class="s1">version </span><span class="s2">? </span><span class="s1">version </span><span class="s2">&gt;= </span><span class="s1">index </span><span class="s2">: </span><span class="s3">0</span><span class="s2">;</span>
                        }

                        <span class="s0">return </span><span class="s1">browsers</span><span class="s2">;</span>
                    },

                    <span class="s4">//OS Detection</span>
                    <span class="s1">getOperatingSystems </span><span class="s2">= </span><span class="s0">function </span><span class="s2">() {</span>
                        <span class="s0">var </span><span class="s1">systems </span><span class="s2">= {},</span>
                            <span class="s1">value</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">match</span><span class="s2">, </span><span class="s1">matched</span><span class="s2">, </span><span class="s1">version</span><span class="s2">, </span><span class="s1">activeCount</span><span class="s2">;</span>

                        <span class="s1">keys </span><span class="s2">= </span><span class="s1">_getKeys</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">osPrefixes</span><span class="s2">);</span>
                        <span class="s1">len </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                        <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s2">= </span><span class="s3">0</span><span class="s2">, </span><span class="s1">activeCount </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">index</span><span class="s2">++) {</span>
                            <span class="s1">key </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                            <span class="s1">value </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">osPrefixes</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
                            <span class="s1">match </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">'(' </span><span class="s2">+ </span><span class="s1">value </span><span class="s2">+ </span><span class="s3">')([^\\s;]+)'</span><span class="s2">));</span>
                            <span class="s1">matched </span><span class="s2">= </span><span class="s1">match </span><span class="s2">? </span><span class="s1">match</span><span class="s2">[</span><span class="s3">1</span><span class="s2">] : </span><span class="s0">null</span><span class="s2">;</span>

                            <span class="s4">// This is here because some HTC android devices show an OSX Snow Leopard userAgent by default.</span>
                            // And the Kindle Fire doesn't have any indicator of Android as the OS in its User Agent
                            <span class="s0">if </span><span class="s2">(</span><span class="s1">matched </span><span class="s2">&amp;&amp; (</span><span class="s1">matched </span><span class="s2">=== </span><span class="s3">'HTC_' </span><span class="s2">|| </span><span class="s1">matched </span><span class="s2">=== </span><span class="s3">'Silk/'</span><span class="s2">)) {</span>
                                <span class="s1">version </span><span class="s2">= </span><span class="s3">2.3</span><span class="s2">;</span>
                            } <span class="s0">else </span><span class="s2">{</span>
                                <span class="s1">version </span><span class="s2">= </span><span class="s1">match </span><span class="s2">&amp;&amp; </span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">1 </span><span class="s2">? </span><span class="s1">parseFloat</span><span class="s2">(</span><span class="s1">match</span><span class="s2">[</span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s3">1</span><span class="s2">]) : </span><span class="s3">0</span><span class="s2">;</span>
                            }

                            <span class="s0">if </span><span class="s2">(</span><span class="s1">version</span><span class="s2">) {</span>
                                <span class="s1">activeCount</span><span class="s2">++;</span>
                            }
                            <span class="s1">systems</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">version</span><span class="s2">;</span>
                        }

                        <span class="s1">keys </span><span class="s2">= </span><span class="s1">_getKeys</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">fallbackOSPrefixes</span><span class="s2">);</span>

                        <span class="s4">// If no OS could be found we resort to the fallbacks, otherwise we just</span>
                        // falsify the fallbacks
                        <span class="s1">len </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                        <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">index</span><span class="s2">++) {</span>
                            <span class="s1">key </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>

                            <span class="s4">// No OS was detected from osPrefixes</span>
                            <span class="s0">if </span><span class="s2">(</span><span class="s1">activeCount </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) {</span>
                                <span class="s1">value </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">fallbackOSPrefixes</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
                                <span class="s1">match </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">toLowerCase</span><span class="s2">().</span><span class="s1">match</span><span class="s2">(</span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">value</span><span class="s2">));</span>
                                <span class="s1">systems</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">match </span><span class="s2">? </span><span class="s0">true </span><span class="s2">: </span><span class="s3">0</span><span class="s2">;</span>
                            } <span class="s0">else </span><span class="s2">{</span>
                                <span class="s1">systems</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s3">0</span><span class="s2">;</span>
                            }
                        }

                        <span class="s0">return </span><span class="s1">systems</span><span class="s2">;</span>
                    },

                    <span class="s4">// Device Detection</span>
                    <span class="s1">getDevices </span><span class="s2">= </span><span class="s0">function </span><span class="s2">() {</span>
                        <span class="s0">var </span><span class="s1">devices </span><span class="s2">= {},</span>
                            <span class="s1">value</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">match</span><span class="s2">;</span>

                        <span class="s1">keys </span><span class="s2">= </span><span class="s1">_getKeys</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">devicePrefixes</span><span class="s2">);</span>
                        <span class="s1">len </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                        <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">index</span><span class="s2">++) {</span>
                            <span class="s1">key </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                            <span class="s1">value </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">devicePrefixes</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
                            <span class="s1">match </span><span class="s2">= </span><span class="s1">ua</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">value</span><span class="s2">));</span>
                            <span class="s1">devices</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">match </span><span class="s2">? </span><span class="s0">true </span><span class="s2">: </span><span class="s3">0</span><span class="s2">;</span>
                        }

                        <span class="s0">return </span><span class="s1">devices</span><span class="s2">;</span>
                    },
                    <span class="s1">browsers </span><span class="s2">= </span><span class="s1">getBrowsers</span><span class="s2">(),</span>
                    <span class="s1">systems </span><span class="s2">= </span><span class="s1">getOperatingSystems</span><span class="s2">(),</span>
                    <span class="s1">devices </span><span class="s2">= </span><span class="s1">getDevices</span><span class="s2">(),</span>
                    <span class="s1">platformParams </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">loadPlatformsParam</span><span class="s2">();</span>

                <span class="s4">// We apply platformParams from the query here first to allow for forced user valued</span>
                // to be used in calculation of generated tags
                <span class="s1">_merge</span><span class="s2">(</span><span class="s1">_tags</span><span class="s2">, </span><span class="s1">browsers</span><span class="s2">, </span><span class="s1">systems</span><span class="s2">, </span><span class="s1">devices</span><span class="s2">, </span><span class="s1">platformParams</span><span class="s2">, </span><span class="s0">true</span><span class="s2">);</span>

                <span class="s1">_tags</span><span class="s2">.</span><span class="s1">phone </span><span class="s2">= !!((</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">iphone </span><span class="s2">|| </span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">ipod</span><span class="s2">) ||</span>
                    (!<span class="s1">_tags</span><span class="s2">.</span><span class="s1">silk </span><span class="s2">&amp;&amp; (</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">android </span><span class="s2">&amp;&amp; (</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">android </span><span class="s2">&lt; </span><span class="s3">3 </span><span class="s2">|| </span><span class="s1">isMobile</span><span class="s2">))) ||</span>
                    (<span class="s1">_tags</span><span class="s2">.</span><span class="s1">blackberry </span><span class="s2">&amp;&amp; </span><span class="s1">isMobile</span><span class="s2">) ||</span>
                    (<span class="s1">_tags</span><span class="s2">.</span><span class="s1">windowsphone</span><span class="s2">));</span>

                <span class="s1">_tags</span><span class="s2">.</span><span class="s1">tablet </span><span class="s2">= !!(!</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">phone </span><span class="s2">&amp;&amp; (</span>
                        <span class="s1">_tags</span><span class="s2">.</span><span class="s1">ipad </span><span class="s2">||</span>
                        <span class="s1">_tags</span><span class="s2">.</span><span class="s1">android </span><span class="s2">||</span>
                        <span class="s1">_tags</span><span class="s2">.</span><span class="s1">silk </span><span class="s2">||</span>
                        <span class="s1">_tags</span><span class="s2">.</span><span class="s1">rimtablet </span><span class="s2">||</span>
                        (<span class="s1">_tags</span><span class="s2">.</span><span class="s1">ie10 </span><span class="s2">&amp;&amp; </span><span class="s5">/; Touch/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">))</span>
                    ));

                <span class="s1">_tags</span><span class="s2">.</span><span class="s1">touch </span><span class="s2">=</span>
                    <span class="s4">// if the browser has touch events we can be reasonably sure the device has</span>
                    // a touch screen
                    <span class="s1">isEventSupported</span><span class="s2">(</span><span class="s3">'touchend'</span><span class="s2">) ||</span>
                    <span class="s4">// browsers that use pointer event have maxTouchPoints &gt; 0 if the</span>
                    // device supports touch input
                    // http://www.w3.org/TR/pointerevents/#widl-Navigator-maxTouchPoints
                    <span class="s1">navigator</span><span class="s2">.</span><span class="s1">maxTouchPoints </span><span class="s2">||</span>
                    <span class="s4">// IE10 uses a vendor-prefixed maxTouchPoints property</span>
                    <span class="s1">navigator</span><span class="s2">.</span><span class="s1">msMaxTouchPoints</span><span class="s2">;</span>

                <span class="s1">_tags</span><span class="s2">.</span><span class="s1">desktop </span><span class="s2">= !</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">phone </span><span class="s2">&amp;&amp; !</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">tablet</span><span class="s2">;</span>
                <span class="s1">_tags</span><span class="s2">.</span><span class="s1">cordova </span><span class="s2">= </span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">phonegap </span><span class="s2">= !!(</span><span class="s1">window</span><span class="s2">.</span><span class="s1">PhoneGap </span><span class="s2">|| </span><span class="s1">window</span><span class="s2">.</span><span class="s1">Cordova </span><span class="s2">|| </span><span class="s1">window</span><span class="s2">.</span><span class="s1">cordova</span><span class="s2">);</span>
                <span class="s1">_tags</span><span class="s2">.</span><span class="s1">webview </span><span class="s2">= </span><span class="s5">/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)(?!.*FBAN)/i</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">ua</span><span class="s2">);</span>
                <span class="s1">_tags</span><span class="s2">.</span><span class="s1">androidstock </span><span class="s2">= (</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">android </span><span class="s2">&lt;= </span><span class="s3">4.3</span><span class="s2">) &amp;&amp; (</span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">safari </span><span class="s2">|| </span><span class="s1">_tags</span><span class="s2">.</span><span class="s1">silk</span><span class="s2">);</span>

                <span class="s4">// Re-apply any query params here to allow for user override of generated tags (desktop, touch, tablet, etc)</span>
                <span class="s1">_merge</span><span class="s2">(</span><span class="s1">_tags</span><span class="s2">, </span><span class="s1">platformParams</span><span class="s2">, </span><span class="s0">true</span><span class="s2">);</span>
            },

            <span class="s4">/**</span>
             * Extracts user supplied platform tags from the &quot;platformTags&quot; query parameter
             * of the form:
             *
             *      ?platformTags=name:state,name:state,...
             *
             * (each tag defaults to true when state is unspecified)
             *
             * Example:
             *
             *      ?platformTags=isTablet,isPhone:false,isDesktop:0,iOS:1,Safari:true, ...
             *
             * @returns {Object} the platform tags supplied by the query string
             */
            <span class="s1">loadPlatformsParam</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s4">// Check if the ?platform parameter is set in the URL</span>
                <span class="s0">var </span><span class="s1">paramsString </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">search</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s3">1</span><span class="s2">),</span>
                    <span class="s1">paramsArray </span><span class="s2">= </span><span class="s1">paramsString</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;&amp;&quot;</span><span class="s2">),</span>
                    <span class="s1">params </span><span class="s2">= {}, </span><span class="s1">i</span><span class="s2">,</span>
                    <span class="s1">platforms </span><span class="s2">= {},</span>
                    <span class="s1">tmpArray</span><span class="s2">, </span><span class="s1">tmplen</span><span class="s2">, </span><span class="s1">platform</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">enabled</span><span class="s2">;</span>

                <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">paramsArray</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">tmpArray </span><span class="s2">= </span><span class="s1">paramsArray</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;=&quot;</span><span class="s2">);</span>
                    <span class="s1">params</span><span class="s2">[</span><span class="s1">tmpArray</span><span class="s2">[</span><span class="s3">0</span><span class="s2">]] = </span><span class="s1">tmpArray</span><span class="s2">[</span><span class="s3">1</span><span class="s2">];</span>
                }

                <span class="s0">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">platformTags</span><span class="s2">) {</span>
                    <span class="s1">tmpArray </span><span class="s2">= </span><span class="s1">params</span><span class="s2">.</span><span class="s1">platformTags</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;,&quot;</span><span class="s2">);</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">tmplen </span><span class="s2">= </span><span class="s1">tmpArray</span><span class="s2">.</span><span class="s1">length</span><span class="s2">, </span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">tmplen</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                        <span class="s1">platform </span><span class="s2">= </span><span class="s1">tmpArray</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">split</span><span class="s2">(</span><span class="s3">&quot;:&quot;</span><span class="s2">);</span>
                        <span class="s1">name </span><span class="s2">= </span><span class="s1">platform</span><span class="s2">[</span><span class="s3">0</span><span class="s2">];</span>
                        <span class="s1">enabled</span><span class="s2">=</span><span class="s0">true</span><span class="s2">;</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">platform</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">1</span><span class="s2">) {</span>
                            <span class="s1">enabled </span><span class="s2">= </span><span class="s1">platform</span><span class="s2">[</span><span class="s3">1</span><span class="s2">];</span>
                            <span class="s0">if </span><span class="s2">(</span><span class="s1">enabled </span><span class="s2">=== </span><span class="s3">'false' </span><span class="s2">|| </span><span class="s1">enabled </span><span class="s2">=== </span><span class="s3">'0'</span><span class="s2">) {</span>
                                <span class="s1">enabled </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                            }
                        }
                        <span class="s1">platforms</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">enabled</span><span class="s2">;</span>
                    }
                }
                <span class="s0">return </span><span class="s1">platforms</span><span class="s2">;</span>
            },

            <span class="s1">filterPlatform</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">platform</span><span class="s2">, </span><span class="s1">excludes</span><span class="s2">) {</span>
                <span class="s1">platform </span><span class="s2">= </span><span class="s1">_emptyArray</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">platform </span><span class="s2">|| </span><span class="s1">_emptyArray</span><span class="s2">);</span>
                <span class="s1">excludes </span><span class="s2">= </span><span class="s1">_emptyArray</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">excludes </span><span class="s2">|| </span><span class="s1">_emptyArray</span><span class="s2">);</span>

                <span class="s0">var </span><span class="s1">plen </span><span class="s2">= </span><span class="s1">platform</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                    <span class="s1">elen </span><span class="s2">= </span><span class="s1">excludes</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                    <span class="s1">include </span><span class="s2">= (!</span><span class="s1">plen </span><span class="s2">&amp;&amp; </span><span class="s1">elen</span><span class="s2">), </span><span class="s4">// default true if only excludes specified</span>
                    <span class="s1">i</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">;</span>

                <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">plen </span><span class="s2">&amp;&amp; !</span><span class="s1">include</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">tag </span><span class="s2">= </span><span class="s1">platform</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                    <span class="s1">include </span><span class="s2">= !!</span><span class="s1">_tags</span><span class="s2">[</span><span class="s1">tag</span><span class="s2">];</span>
                }

                <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">elen </span><span class="s2">&amp;&amp; </span><span class="s1">include</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">tag </span><span class="s2">= </span><span class="s1">excludes</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                    <span class="s1">include </span><span class="s2">= !</span><span class="s1">_tags</span><span class="s2">[</span><span class="s1">tag</span><span class="s2">];</span>
                }

                <span class="s0">return </span><span class="s1">include</span><span class="s2">;</span>
            },

            <span class="s1">init</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">var </span><span class="s1">scriptEls </span><span class="s2">= </span><span class="s1">doc</span><span class="s2">.</span><span class="s1">getElementsByTagName</span><span class="s2">(</span><span class="s3">'script'</span><span class="s2">),</span>
                    <span class="s1">script </span><span class="s2">= </span><span class="s1">scriptEls</span><span class="s2">[</span><span class="s3">0</span><span class="s2">],</span>
                    <span class="s1">len </span><span class="s2">= </span><span class="s1">scriptEls</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                    <span class="s1">re </span><span class="s2">= </span><span class="s5">/\/ext(\-[a-z\-]+)?\.js$/</span><span class="s2">,</span>
                    <span class="s1">entry</span><span class="s2">, </span><span class="s1">src</span><span class="s2">, </span><span class="s1">state</span><span class="s2">, </span><span class="s1">baseUrl</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">n</span><span class="s2">, </span><span class="s1">origin</span><span class="s2">;</span>

                <span class="s4">// No check for script definedness because there always should be at least one</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasReadyState </span><span class="s2">= (</span><span class="s3">&quot;readyState&quot; </span><span class="s0">in </span><span class="s1">script</span><span class="s2">);</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasAsync </span><span class="s2">= (</span><span class="s3">&quot;async&quot; </span><span class="s0">in </span><span class="s1">script</span><span class="s2">);</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasDefer </span><span class="s2">= (</span><span class="s3">&quot;defer&quot; </span><span class="s0">in </span><span class="s1">script</span><span class="s2">);</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasOnLoad </span><span class="s2">= (</span><span class="s3">&quot;onload&quot; </span><span class="s0">in </span><span class="s1">script</span><span class="s2">);</span>
                
                <span class="s4">// Feature detecting IE</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE8 </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasReadyState </span><span class="s2">&amp;&amp; !</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasAsync </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasDefer </span><span class="s2">&amp;&amp; !</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasOnLoad</span><span class="s2">;</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE9 </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasReadyState </span><span class="s2">&amp;&amp; !</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasAsync </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasDefer </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasOnLoad</span><span class="s2">;</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10p </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasReadyState </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasAsync </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasDefer </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasOnLoad</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE8</span><span class="s2">) {</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10 </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10m </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                }
                <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10 </span><span class="s2">= (</span><span class="s0">new </span><span class="s1">Function</span><span class="s2">(</span><span class="s3">'/*@cc_on return @_jscript_version @*/'</span><span class="s2">)()) === </span><span class="s3">10</span><span class="s2">;</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10m </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10 </span><span class="s2">|| </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE9 </span><span class="s2">|| </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE8</span><span class="s2">;</span>
                }
                
                <span class="s4">// IE11 does not support conditional compilation so we detect it by exclusion</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE11 </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10p </span><span class="s2">&amp;&amp; !</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10</span><span class="s2">;</span>

                <span class="s4">// Since we are loading after other scripts, and we needed to gather them</span>
                // anyway, we track them in _scripts so we don't have to ask for them all
                // repeatedly.
                <span class="s0">for </span><span class="s2">(</span><span class="s1">n </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">n </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">n</span><span class="s2">++) {</span>
                    <span class="s1">src </span><span class="s2">= (</span><span class="s1">script </span><span class="s2">= </span><span class="s1">scriptEls</span><span class="s2">[</span><span class="s1">n</span><span class="s2">]).</span><span class="s1">src</span><span class="s2">;</span>
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">src</span><span class="s2">) {</span>
                        <span class="s0">continue</span><span class="s2">;</span>
                    }
                    <span class="s1">state </span><span class="s2">= </span><span class="s1">script</span><span class="s2">.</span><span class="s1">readyState </span><span class="s2">|| </span><span class="s0">null</span><span class="s2">;</span>

                    <span class="s4">// If we find a script file called &quot;ext-*.js&quot;, then the base path is that file's base path.</span>
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">baseUrl </span><span class="s2">&amp;&amp; </span><span class="s1">re</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">src</span><span class="s2">)) {</span>
                        <span class="s1">baseUrl </span><span class="s2">= </span><span class="s1">src</span><span class="s2">;</span>
                    }

                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">[</span><span class="s1">key </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">canonicalUrl</span><span class="s2">(</span><span class="s1">src</span><span class="s2">)]) {</span>
<span class="s4">//                         _debug(&quot;creating entry &quot; + key + &quot; in Boot.init&quot;);</span>
                        <span class="s1">entry </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Entry</span><span class="s2">({</span>
                            <span class="s1">key</span><span class="s2">: </span><span class="s1">key</span><span class="s2">,</span>
                            <span class="s1">url</span><span class="s2">: </span><span class="s1">src</span><span class="s2">,</span>
                            <span class="s1">done</span><span class="s2">: </span><span class="s1">state </span><span class="s2">=== </span><span class="s0">null </span><span class="s2">||  </span><span class="s4">// non-IE</span>
                                <span class="s1">state </span><span class="s2">=== </span><span class="s3">'loaded' </span><span class="s2">|| </span><span class="s1">state </span><span class="s2">=== </span><span class="s3">'complete'</span><span class="s2">, </span><span class="s4">// IE only</span>
                            <span class="s1">el</span><span class="s2">: </span><span class="s1">script</span><span class="s2">,</span>
                            <span class="s1">prop</span><span class="s2">: </span><span class="s3">'src'</span>
                        <span class="s2">});</span>
                    }
                }

                <span class="s0">if </span><span class="s2">(!</span><span class="s1">baseUrl</span><span class="s2">) {</span>
                    <span class="s1">script </span><span class="s2">= </span><span class="s1">scriptEls</span><span class="s2">[</span><span class="s1">scriptEls</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s3">1</span><span class="s2">];</span>
                    <span class="s1">baseUrl </span><span class="s2">= </span><span class="s1">script</span><span class="s2">.</span><span class="s1">src</span><span class="s2">;</span>
                }

                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">baseUrl </span><span class="s2">= </span><span class="s1">baseUrl</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">baseUrl</span><span class="s2">.</span><span class="s1">lastIndexOf</span><span class="s2">(</span><span class="s3">'/'</span><span class="s2">) + </span><span class="s3">1</span><span class="s2">);</span>
                <span class="s1">origin </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">origin </span><span class="s2">||</span>
                    <span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">protocol </span><span class="s2">+</span>
                    <span class="s3">&quot;//&quot; </span><span class="s2">+</span>
                    <span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">hostname </span><span class="s2">+</span>
                    (<span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">port </span><span class="s2">? </span><span class="s3">':' </span><span class="s2">+ </span><span class="s1">window</span><span class="s2">.</span><span class="s1">location</span><span class="s2">.</span><span class="s1">port</span><span class="s2">: </span><span class="s3">''</span><span class="s2">);</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">origin </span><span class="s2">= </span><span class="s1">origin</span><span class="s2">;</span>

                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">detectPlatformTags</span><span class="s2">();</span>
                <span class="s1">Ext</span><span class="s2">.</span><span class="s1">filterPlatform </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">filterPlatform</span><span class="s2">;</span>
            },

            <span class="s4">/**</span>
             * This method returns a canonical URL for the given URL.
             *
             * For example, the following all produce the same canonical URL (which is the
             * last one):
             *
             *      http://foo.com/bar/baz/zoo/derp/../../goo/Thing.js?_dc=12345
             *      http://foo.com/bar/baz/zoo/derp/../../goo/Thing.js
             *      http://foo.com/bar/baz/zoo/derp/../jazz/../../goo/Thing.js
             *      http://foo.com/bar/baz/zoo/../goo/Thing.js
             *      http://foo.com/bar/baz/goo/Thing.js
             *
             * @private
             */
            <span class="s1">canonicalUrl</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">url</span><span class="s2">) {</span>
                <span class="s4">// *WARNING WARNING WARNING*</span>
                // This method yields the most correct result we can get but it is EXPENSIVE!
                // In ALL browsers! When called multiple times in a sequence, as if when
                // we resolve dependencies for entries, it will cause garbage collection events
                // and overall painful slowness. This is why we try to avoid it as much as we can.
                // 
                // @TODO - see if we need this fallback logic
                // http://stackoverflow.com/questions/470832/getting-an-absolute-url-from-a-relative-one-ie6-issue
                <span class="s1">resolverEl</span><span class="s2">.</span><span class="s1">href </span><span class="s2">= </span><span class="s1">url</span><span class="s2">;</span>

                <span class="s0">var </span><span class="s1">ret </span><span class="s2">= </span><span class="s1">resolverEl</span><span class="s2">.</span><span class="s1">href</span><span class="s2">,</span>
                    <span class="s1">dc </span><span class="s2">= </span><span class="s1">_config</span><span class="s2">.</span><span class="s1">disableCachingParam</span><span class="s2">,</span>
                    <span class="s1">pos </span><span class="s2">= </span><span class="s1">dc </span><span class="s2">? </span><span class="s1">ret</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">dc </span><span class="s2">+ </span><span class="s3">'='</span><span class="s2">) : -</span><span class="s3">1</span><span class="s2">,</span>
                    <span class="s1">c</span><span class="s2">, </span><span class="s1">end</span><span class="s2">;</span>

                <span class="s4">// If we have a _dc query parameter we need to remove it from the canonical</span>
                // URL.
                <span class="s0">if </span><span class="s2">(</span><span class="s1">pos </span><span class="s2">&gt; </span><span class="s3">0 </span><span class="s2">&amp;&amp; ((</span><span class="s1">c </span><span class="s2">= </span><span class="s1">ret</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s1">pos </span><span class="s2">- </span><span class="s3">1</span><span class="s2">)) === </span><span class="s3">'?' </span><span class="s2">|| </span><span class="s1">c </span><span class="s2">=== </span><span class="s3">'&amp;'</span><span class="s2">)) {</span>
                    <span class="s1">end </span><span class="s2">= </span><span class="s1">ret</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s3">'&amp;'</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">);</span>
                    <span class="s1">end </span><span class="s2">= (</span><span class="s1">end </span><span class="s2">&lt; </span><span class="s3">0</span><span class="s2">) ? </span><span class="s3">'' </span><span class="s2">: </span><span class="s1">ret</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s1">end</span><span class="s2">);</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">end </span><span class="s2">&amp;&amp; </span><span class="s1">c </span><span class="s2">=== </span><span class="s3">'?'</span><span class="s2">) {</span>
                        ++<span class="s1">pos</span><span class="s2">; </span><span class="s4">// keep the '?'</span>
                        <span class="s1">end </span><span class="s2">= </span><span class="s1">end</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">1</span><span class="s2">); </span><span class="s4">// remove the '&amp;'</span>
                    <span class="s2">}</span>
                    <span class="s1">ret </span><span class="s2">= </span><span class="s1">ret</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">pos </span><span class="s2">- </span><span class="s3">1</span><span class="s2">) + </span><span class="s1">end</span><span class="s2">;</span>
                }

                <span class="s0">return </span><span class="s1">ret</span><span class="s2">;</span>
            },

            <span class="s4">/**</span>
             * Get the config value corresponding to the specified name. If no name is given, will return the config object
             * @param {String} name The config property name
             * @return {Object}
             */
            <span class="s1">getConfig</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
                <span class="s0">return </span><span class="s1">name </span><span class="s2">? </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] : </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">;</span>
            },

            <span class="s4">/**</span>
             * Set the configuration.
             * @param {Object} config The config object to override the default values.
             * @return {Ext.Boot} this
             */
            <span class="s1">setConfig</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">name </span><span class="s2">=== </span><span class="s3">'string'</span><span class="s2">) {</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">s </span><span class="s0">in </span><span class="s1">name</span><span class="s2">) {</span>
                        <span class="s1">Boot</span><span class="s2">.</span><span class="s1">setConfig</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s1">name</span><span class="s2">[</span><span class="s1">s</span><span class="s2">]);</span>
                    }
                }
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">;</span>
            },

            <span class="s1">getHead</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">docHead </span><span class="s2">||</span>
                    (<span class="s1">Boot</span><span class="s2">.</span><span class="s1">docHead </span><span class="s2">= </span><span class="s1">doc</span><span class="s2">.</span><span class="s1">head </span><span class="s2">||</span>
                        <span class="s1">doc</span><span class="s2">.</span><span class="s1">getElementsByTagName</span><span class="s2">(</span><span class="s3">'head'</span><span class="s2">)[</span><span class="s3">0</span><span class="s2">]);</span>
            },

            <span class="s1">create</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">config </span><span class="s2">= </span><span class="s1">cfg </span><span class="s2">|| {};</span>
                <span class="s1">config</span><span class="s2">.</span><span class="s1">url </span><span class="s2">= </span><span class="s1">url</span><span class="s2">;</span>
                <span class="s1">config</span><span class="s2">.</span><span class="s1">key </span><span class="s2">= </span><span class="s1">key</span><span class="s2">;</span>
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s0">new </span><span class="s1">Entry</span><span class="s2">(</span><span class="s1">config</span><span class="s2">);</span>
            },

            <span class="s1">getEntry</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">, </span><span class="s1">canonicalPath</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">key</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">;</span>
                
                <span class="s4">// Canonicalizing URLs via anchor element href yields the most correct result</span>
                // but is *extremely* resource heavy so we need to avoid it whenever possible
                <span class="s1">key </span><span class="s2">= </span><span class="s1">canonicalPath </span><span class="s2">? </span><span class="s1">url </span><span class="s2">: </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">canonicalUrl</span><span class="s2">(</span><span class="s1">url</span><span class="s2">);</span>
                <span class="s1">entry </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">scripts</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
                
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">entry</span><span class="s2">) {</span>
                    <span class="s1">entry </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">);</span>
                    
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">canonicalPath</span><span class="s2">) {</span>
                        <span class="s1">entry</span><span class="s2">.</span><span class="s1">canonicalPath </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                    }
                }
                
                <span class="s0">return </span><span class="s1">entry</span><span class="s2">;</span>
            },

            <span class="s1">registerContent</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">type</span><span class="s2">, </span><span class="s1">content</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">cfg </span><span class="s2">= {</span>
                    <span class="s1">content</span><span class="s2">: </span><span class="s1">content</span><span class="s2">,</span>
                    <span class="s1">loaded</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>
                    <span class="s1">css</span><span class="s2">: </span><span class="s1">type </span><span class="s2">=== </span><span class="s3">'css'</span>
                <span class="s2">};</span>

                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">getEntry</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">);</span>
            },

            <span class="s1">processRequest</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">request</span><span class="s2">, </span><span class="s1">sync</span><span class="s2">) {</span>
                <span class="s1">request</span><span class="s2">.</span><span class="s1">loadEntries</span><span class="s2">(</span><span class="s1">sync</span><span class="s2">);</span>
            },

            <span class="s1">load</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">request</span><span class="s2">) {</span>
<span class="s4">//                 _debug(&quot;Boot.load called&quot;);</span>
                <span class="s0">var </span><span class="s1">request </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Request</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">request</span><span class="s2">.</span><span class="s1">sync </span><span class="s2">|| </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">syncMode</span><span class="s2">) {</span>
                    <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">loadSync</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>
                }

                <span class="s4">// If there is a request in progress, we must</span>
                // queue this new request to be fired  when the current request completes.
                <span class="s0">if </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">currentRequest</span><span class="s2">) {</span>
<span class="s4">//                     _debug(&quot;current active request, suspending this request&quot;);</span>
                    // trigger assignment of entries now to ensure that overlapping
                    // entries with currently running requests will synchronize state
                    // with this pending one as they complete
                    <span class="s1">request</span><span class="s2">.</span><span class="s1">getEntries</span><span class="s2">();</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">suspendedQueue</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">currentRequest </span><span class="s2">= </span><span class="s1">request</span><span class="s2">;</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">processRequest</span><span class="s2">(</span><span class="s1">request</span><span class="s2">, </span><span class="s0">false</span><span class="s2">);</span>
                }
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">;</span>
            },

            <span class="s1">loadSync</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">request</span><span class="s2">) {</span>
<span class="s4">//                 _debug(&quot;Boot.loadSync called&quot;);</span>
                <span class="s0">var </span><span class="s1">request </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Request</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>

                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">syncMode</span><span class="s2">++;</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">processRequest</span><span class="s2">(</span><span class="s1">request</span><span class="s2">, </span><span class="s0">true</span><span class="s2">);</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">syncMode</span><span class="s2">--;</span>
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">;</span>
            },

            <span class="s1">loadBasePrefix</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">request</span><span class="s2">) {</span>
                <span class="s1">request </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Request</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>
                <span class="s1">request</span><span class="s2">.</span><span class="s1">prependBaseUrl </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>
            },

            <span class="s1">loadSyncBasePrefix</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">request</span><span class="s2">) {</span>
                <span class="s1">request </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Request</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>
                <span class="s1">request</span><span class="s2">.</span><span class="s1">prependBaseUrl </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">loadSync</span><span class="s2">(</span><span class="s1">request</span><span class="s2">);</span>
            },

            <span class="s1">requestComplete</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">request</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">next</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">currentRequest </span><span class="s2">=== </span><span class="s1">request</span><span class="s2">) {</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">currentRequest </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                    <span class="s0">while</span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">suspendedQueue</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                        <span class="s1">next </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">suspendedQueue</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">();</span>
                        <span class="s0">if</span><span class="s2">(!</span><span class="s1">next</span><span class="s2">.</span><span class="s1">done</span><span class="s2">) {</span>
<span class="s4">//                             _debug(&quot;resuming suspended request&quot;);</span>
                            <span class="s1">Boot</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">next</span><span class="s2">);</span>
                            <span class="s0">break</span><span class="s2">;</span>
                        }
                    }
                }
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">currentRequest </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">suspendedQueue</span><span class="s2">.</span><span class="s1">length </span><span class="s2">== </span><span class="s3">0</span><span class="s2">) {</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">fireListeners</span><span class="s2">();</span>
                }
            },

            <span class="s1">isLoading</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">return </span><span class="s2">!</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">currentRequest </span><span class="s2">&amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">suspendedQueue</span><span class="s2">.</span><span class="s1">length </span><span class="s2">== </span><span class="s3">0</span><span class="s2">;</span>
            },

            <span class="s1">fireListeners</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">var </span><span class="s1">listener</span><span class="s2">;</span>
                <span class="s0">while </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isLoading</span><span class="s2">() &amp;&amp; (</span><span class="s1">listener </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">())) {</span>
                    <span class="s1">listener</span><span class="s2">();</span>
                }
            },

            <span class="s1">onBootReady</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">listener</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isLoading</span><span class="s2">()) {</span>
                    <span class="s1">listener</span><span class="s2">();</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">listener</span><span class="s2">);</span>
                }
            },

            <span class="s4">/**</span>
             * this is a helper function used by Ext.Loader to flush out
             * 'uses' arrays for classes in some Ext versions
             */
            <span class="s1">getPathsFromIndexes</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">indexMap</span><span class="s2">, </span><span class="s1">loadOrder</span><span class="s2">) {</span>
                <span class="s4">// In older versions indexMap was an object instead of a sparse array</span>
                <span class="s0">if </span><span class="s2">(!(</span><span class="s3">'length' </span><span class="s0">in </span><span class="s1">indexMap</span><span class="s2">)) {</span>
                    <span class="s0">var </span><span class="s1">indexArray </span><span class="s2">= [],</span>
                        <span class="s1">index</span><span class="s2">;</span>
                    
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s0">in </span><span class="s1">indexMap</span><span class="s2">) {</span>
                        <span class="s0">if </span><span class="s2">(!</span><span class="s1">isNaN</span><span class="s2">(+</span><span class="s1">index</span><span class="s2">)) {</span>
                            <span class="s1">indexArray</span><span class="s2">[+</span><span class="s1">index</span><span class="s2">] = </span><span class="s1">indexMap</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                        }
                    }
                    
                    <span class="s1">indexMap </span><span class="s2">= </span><span class="s1">indexArray</span><span class="s2">;</span>
                }
                
                <span class="s0">return </span><span class="s1">Request</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">getPathsFromIndexes</span><span class="s2">(</span><span class="s1">indexMap</span><span class="s2">, </span><span class="s1">loadOrder</span><span class="s2">);</span>
            },

            <span class="s1">createLoadOrderMap</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">) {</span>
                <span class="s0">return </span><span class="s1">Request</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">createLoadOrderMap</span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">);</span>
            },

            <span class="s1">fetch</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">complete</span><span class="s2">, </span><span class="s1">scope</span><span class="s2">, </span><span class="s1">async</span><span class="s2">) {</span>
                <span class="s1">async </span><span class="s2">= (</span><span class="s1">async </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) ? !!</span><span class="s1">complete </span><span class="s2">: </span><span class="s1">async</span><span class="s2">;</span>

                <span class="s0">var </span><span class="s1">xhr </span><span class="s2">= </span><span class="s0">new </span><span class="s1">XMLHttpRequest</span><span class="s2">(),</span>
                    <span class="s1">result</span><span class="s2">, </span><span class="s1">status</span><span class="s2">, </span><span class="s1">content</span><span class="s2">, </span><span class="s1">exception </span><span class="s2">= </span><span class="s0">false</span><span class="s2">,</span>
                    <span class="s1">readyStateChange </span><span class="s2">= </span><span class="s0">function </span><span class="s2">() {</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">xhr </span><span class="s2">&amp;&amp; </span><span class="s1">xhr</span><span class="s2">.</span><span class="s1">readyState </span><span class="s2">== </span><span class="s3">4</span><span class="s2">) {</span>
                            <span class="s1">status </span><span class="s2">= (</span><span class="s1">xhr</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s3">1223</span><span class="s2">) ? </span><span class="s3">204 </span><span class="s2">:</span>
                                (<span class="s1">xhr</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s3">0 </span><span class="s2">&amp;&amp; ((</span><span class="s1">self</span><span class="s2">.</span><span class="s1">location </span><span class="s2">|| {}).</span><span class="s1">protocol </span><span class="s2">=== </span><span class="s3">'file:' </span><span class="s2">||</span>
                                    (<span class="s1">self</span><span class="s2">.</span><span class="s1">location </span><span class="s2">|| {}).</span><span class="s1">protocol </span><span class="s2">=== </span><span class="s3">'ionp:'</span><span class="s2">)) ? </span><span class="s3">200 </span><span class="s2">: </span><span class="s1">xhr</span><span class="s2">.</span><span class="s1">status</span><span class="s2">;</span>
                            <span class="s1">content </span><span class="s2">= </span><span class="s1">xhr</span><span class="s2">.</span><span class="s1">responseText</span><span class="s2">;</span>
                            <span class="s1">result </span><span class="s2">= {</span>
                                <span class="s1">content</span><span class="s2">: </span><span class="s1">content</span><span class="s2">,</span>
                                <span class="s1">status</span><span class="s2">: </span><span class="s1">status</span><span class="s2">,</span>
                                <span class="s1">exception</span><span class="s2">: </span><span class="s1">exception</span>
                            <span class="s2">};</span>
                            <span class="s0">if </span><span class="s2">(</span><span class="s1">complete</span><span class="s2">) {</span>
                                <span class="s1">complete</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">scope</span><span class="s2">, </span><span class="s1">result</span><span class="s2">);</span>
                            }
                            <span class="s1">xhr</span><span class="s2">.</span><span class="s1">onreadystatechange </span><span class="s2">= </span><span class="s1">emptyFn</span><span class="s2">;</span>
                            <span class="s1">xhr </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                        }
                    };

                <span class="s0">if </span><span class="s2">(</span><span class="s1">async</span><span class="s2">) {</span>
                    <span class="s1">xhr</span><span class="s2">.</span><span class="s1">onreadystatechange </span><span class="s2">= </span><span class="s1">readyStateChange</span><span class="s2">;</span>
                }

                <span class="s0">try </span><span class="s2">{</span>
<span class="s4">//                     _debug(&quot;fetching &quot; + url + &quot; &quot; + (async ? &quot;async&quot; : &quot;sync&quot;));</span>
                    <span class="s1">xhr</span><span class="s2">.</span><span class="s1">open</span><span class="s2">(</span><span class="s3">'GET'</span><span class="s2">, </span><span class="s1">url</span><span class="s2">, </span><span class="s1">async</span><span class="s2">);</span>
                    <span class="s1">xhr</span><span class="s2">.</span><span class="s1">send</span><span class="s2">(</span><span class="s0">null</span><span class="s2">);</span>
                } <span class="s0">catch </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span>
                    <span class="s1">exception </span><span class="s2">= </span><span class="s1">err</span><span class="s2">;</span>
                    <span class="s1">readyStateChange</span><span class="s2">();</span>
                    <span class="s0">return </span><span class="s1">result</span><span class="s2">;</span>
                }

                <span class="s0">if </span><span class="s2">(!</span><span class="s1">async</span><span class="s2">) {</span>
                    <span class="s1">readyStateChange</span><span class="s2">();</span>
                }

                <span class="s0">return </span><span class="s1">result</span><span class="s2">;</span>
            },

            <span class="s1">notifyAll</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">entry</span><span class="s2">) {</span>
                <span class="s1">entry</span><span class="s2">.</span><span class="s1">notifyRequests</span><span class="s2">();</span>
            }
        };

    <span class="s0">function </span><span class="s1">Request</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">) {</span>
         <span class="s4">//The request class encapsulates a series of Entry objects</span>
         //and provides notification around the completion of all Entries
         //in this request.

        <span class="s0">if</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">$isRequest</span><span class="s2">) {</span>
            <span class="s0">return </span><span class="s1">cfg</span><span class="s2">;</span>
        }

        <span class="s0">var </span><span class="s1">cfg </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">url </span><span class="s2">? </span><span class="s1">cfg </span><span class="s2">: {</span><span class="s1">url</span><span class="s2">: </span><span class="s1">cfg</span><span class="s2">},</span>
            <span class="s1">url </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">url</span><span class="s2">,</span>
            <span class="s1">urls </span><span class="s2">= </span><span class="s1">url</span><span class="s2">.</span><span class="s1">charAt </span><span class="s2">? [ </span><span class="s1">url </span><span class="s2">] : </span><span class="s1">url</span><span class="s2">,</span>
            <span class="s1">charset </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">charset </span><span class="s2">|| </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">charset</span><span class="s2">;</span>

        <span class="s1">_apply</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">);</span>
            
        <span class="s0">delete this</span><span class="s2">.</span><span class="s1">url</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">urls </span><span class="s2">= </span><span class="s1">urls</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">charset </span><span class="s2">= </span><span class="s1">charset</span><span class="s2">;</span>
    };
    
    <span class="s1">Request</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= {</span>
        <span class="s1">$isRequest</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>

        <span class="s1">createLoadOrderMap</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">len </span><span class="s2">= </span><span class="s1">loadOrder</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                <span class="s1">loadOrderMap </span><span class="s2">= {},</span>
                <span class="s1">i</span><span class="s2">, </span><span class="s1">element</span><span class="s2">;</span>

            <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s1">element </span><span class="s2">= </span><span class="s1">loadOrder</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                <span class="s1">loadOrderMap</span><span class="s2">[</span><span class="s1">element</span><span class="s2">.</span><span class="s1">path</span><span class="s2">] = </span><span class="s1">element</span><span class="s2">;</span>
            }

            <span class="s0">return </span><span class="s1">loadOrderMap</span><span class="s2">;</span>
        },

        <span class="s1">getLoadIndexes</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">indexMap</span><span class="s2">, </span><span class="s1">loadOrder</span><span class="s2">, </span><span class="s1">includeUses</span><span class="s2">, </span><span class="s1">skipLoaded</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">resolved </span><span class="s2">= [],</span>
                <span class="s1">queue </span><span class="s2">= [</span><span class="s1">item</span><span class="s2">],</span>
                <span class="s1">itemIndex </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">idx</span><span class="s2">,</span>
                <span class="s1">queue</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">, </span><span class="s1">dependencies</span><span class="s2">, </span><span class="s1">depIndex</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">len</span><span class="s2">;</span>
            
            <span class="s0">if </span><span class="s2">(</span><span class="s1">indexMap</span><span class="s2">[</span><span class="s1">itemIndex</span><span class="s2">]) {</span>
                <span class="s4">// prevent cycles</span>
                <span class="s0">return </span><span class="s1">resolved</span><span class="s2">;</span>
            }
            
            <span class="s4">// Both indexMap and resolved are sparse arrays keyed by indexes.</span>
            // This gives us a naturally sorted sequence of indexes later on
            // when we need to convert them to paths.
            // indexMap is the map of all indexes we have visited at least once
            // per the current expandUrls() invocation, and resolved is the map
            // of all dependencies for the current item that are not included
            // in indexMap.
            <span class="s1">indexMap</span><span class="s2">[</span><span class="s1">itemIndex</span><span class="s2">] = </span><span class="s1">resolved</span><span class="s2">[</span><span class="s1">itemIndex</span><span class="s2">] = </span><span class="s0">true</span><span class="s2">;</span>
            
            <span class="s0">while </span><span class="s2">(</span><span class="s1">item </span><span class="s2">= </span><span class="s1">queue</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">()) {</span>
                <span class="s4">// Canonicalizing URLs is expensive, we try to avoid it</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">canonicalPath</span><span class="s2">) {</span>
                    <span class="s1">entry </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">getEntry</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s0">null</span><span class="s2">, </span><span class="s0">true</span><span class="s2">);</span>
                }
                <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">entry </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">getEntry</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">prepareUrl</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">path</span><span class="s2">));</span>
                }
                
                <span class="s0">if </span><span class="s2">(!(</span><span class="s1">skipLoaded </span><span class="s2">&amp;&amp; </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">done</span><span class="s2">)) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">includeUses </span><span class="s2">&amp;&amp; </span><span class="s1">item</span><span class="s2">.</span><span class="s1">uses </span><span class="s2">&amp;&amp; </span><span class="s1">item</span><span class="s2">.</span><span class="s1">uses</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
                        <span class="s1">dependencies </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">requires</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">uses</span><span class="s2">);</span>
                    }
                    <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">dependencies </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">requires</span><span class="s2">;</span>
                    }
                    
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">, </span><span class="s1">len </span><span class="s2">= </span><span class="s1">dependencies</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                        <span class="s1">depIndex </span><span class="s2">= </span><span class="s1">dependencies</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                        
                        <span class="s0">if </span><span class="s2">(!</span><span class="s1">indexMap</span><span class="s2">[</span><span class="s1">depIndex</span><span class="s2">]) {</span>
                            <span class="s1">indexMap</span><span class="s2">[</span><span class="s1">depIndex</span><span class="s2">] = </span><span class="s1">resolved</span><span class="s2">[</span><span class="s1">depIndex</span><span class="s2">] = </span><span class="s0">true</span><span class="s2">;</span>
                            <span class="s1">queue</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">[</span><span class="s1">depIndex</span><span class="s2">]);</span>
                        }
                    }
                }
            }
            
            <span class="s0">return </span><span class="s1">resolved</span><span class="s2">;</span>
        },

        <span class="s1">getPathsFromIndexes</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">indexes</span><span class="s2">, </span><span class="s1">loadOrder</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">paths </span><span class="s2">= [],</span>
                <span class="s1">index</span><span class="s2">, </span><span class="s1">len</span><span class="s2">;</span>
            
            <span class="s4">// indexes is a sparse array with values being true for defined indexes</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s1">index </span><span class="s2">= </span><span class="s3">0</span><span class="s2">, </span><span class="s1">len </span><span class="s2">= </span><span class="s1">indexes</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">index</span><span class="s2">++) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">indexes</span><span class="s2">[</span><span class="s1">index</span><span class="s2">]) {</span>
                    <span class="s1">paths</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">[</span><span class="s1">index</span><span class="s2">].</span><span class="s1">path</span><span class="s2">);</span>
                }
            }
            
            <span class="s0">return </span><span class="s1">paths</span><span class="s2">;</span>
        },

        <span class="s1">expandUrl</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">loadOrder</span><span class="s2">, </span><span class="s1">loadOrderMap</span><span class="s2">, </span><span class="s1">indexMap</span><span class="s2">, </span><span class="s1">includeUses</span><span class="s2">, </span><span class="s1">skipLoaded</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">item</span><span class="s2">, </span><span class="s1">resolved</span><span class="s2">;</span>
            
            <span class="s0">if </span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">) {</span>
                <span class="s1">item </span><span class="s2">= </span><span class="s1">loadOrderMap</span><span class="s2">[</span><span class="s1">url</span><span class="s2">];</span>
                
                <span class="s0">if </span><span class="s2">(</span><span class="s1">item</span><span class="s2">) {</span>
                    <span class="s1">resolved </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getLoadIndexes</span><span class="s2">(</span><span class="s1">item</span><span class="s2">, </span><span class="s1">indexMap</span><span class="s2">, </span><span class="s1">loadOrder</span><span class="s2">, </span><span class="s1">includeUses</span><span class="s2">, </span><span class="s1">skipLoaded</span><span class="s2">);</span>
                    
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">resolved</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
                        <span class="s0">return this</span><span class="s2">.</span><span class="s1">getPathsFromIndexes</span><span class="s2">(</span><span class="s1">resolved</span><span class="s2">, </span><span class="s1">loadOrder</span><span class="s2">);</span>
                    }
                }
            }
            
            <span class="s0">return </span><span class="s2">[</span><span class="s1">url</span><span class="s2">];</span>
        },

        <span class="s1">expandUrls</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">urls</span><span class="s2">, </span><span class="s1">includeUses</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">loadOrder </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadOrder</span><span class="s2">,</span>
                <span class="s1">expanded </span><span class="s2">= [],</span>
                <span class="s1">expandMap </span><span class="s2">= {},</span>
                <span class="s1">indexMap </span><span class="s2">= [],</span>
                <span class="s1">loadOrderMap</span><span class="s2">, </span><span class="s1">tmpExpanded</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">t</span><span class="s2">, </span><span class="s1">tlen</span><span class="s2">, </span><span class="s1">tUrl</span><span class="s2">;</span>
            
            <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">urls </span><span class="s2">=== </span><span class="s3">&quot;string&quot;</span><span class="s2">) {</span>
                <span class="s1">urls </span><span class="s2">= [</span><span class="s1">urls</span><span class="s2">];</span>
            }
            
            <span class="s0">if </span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">) {</span>
                <span class="s1">loadOrderMap </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadOrderMap</span><span class="s2">;</span>
                
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">loadOrderMap</span><span class="s2">) {</span>
                    <span class="s1">loadOrderMap </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadOrderMap </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">createLoadOrderMap</span><span class="s2">(</span><span class="s1">loadOrder</span><span class="s2">);</span>
                }
            }
            
            <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">, </span><span class="s1">len </span><span class="s2">= </span><span class="s1">urls</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s4">// We don't want to skip loaded entries (last argument === false).</span>
                // There are some overrides that get loaded before their respective classes,
                // and when the class dependencies are processed we don't want to skip over
                // the overrides' dependencies just because they were loaded first.
                <span class="s1">tmpExpanded </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">expandUrl</span><span class="s2">(</span><span class="s1">urls</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">loadOrder</span><span class="s2">, </span><span class="s1">loadOrderMap</span><span class="s2">, </span><span class="s1">indexMap</span><span class="s2">, </span><span class="s1">includeUses</span><span class="s2">, </span><span class="s0">false</span><span class="s2">);</span>
                
                <span class="s0">for </span><span class="s2">(</span><span class="s1">t </span><span class="s2">= </span><span class="s3">0</span><span class="s2">, </span><span class="s1">tlen </span><span class="s2">= </span><span class="s1">tmpExpanded</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">t </span><span class="s2">&lt; </span><span class="s1">tlen</span><span class="s2">; </span><span class="s1">t</span><span class="s2">++) {</span>
                    <span class="s1">tUrl </span><span class="s2">= </span><span class="s1">tmpExpanded</span><span class="s2">[</span><span class="s1">t</span><span class="s2">];</span>
                    
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">expandMap</span><span class="s2">[</span><span class="s1">tUrl</span><span class="s2">]) {</span>
                        <span class="s1">expandMap</span><span class="s2">[</span><span class="s1">tUrl</span><span class="s2">] = </span><span class="s0">true</span><span class="s2">;</span>
                        <span class="s1">expanded</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">tUrl</span><span class="s2">);</span>
                    }
                }
            }
            
            <span class="s0">if </span><span class="s2">(</span><span class="s1">expanded</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) {</span>
                <span class="s1">expanded </span><span class="s2">= </span><span class="s1">urls</span><span class="s2">;</span>
            }
            
            <span class="s0">return </span><span class="s1">expanded</span><span class="s2">;</span>
        },

        <span class="s1">expandLoadOrder</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">urls </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">urls</span><span class="s2">,</span>
                <span class="s1">expanded</span><span class="s2">;</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">expanded</span><span class="s2">) {</span>
                <span class="s1">expanded </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">expandUrls</span><span class="s2">(</span><span class="s1">urls</span><span class="s2">, </span><span class="s0">true</span><span class="s2">);</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">expanded </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
            } <span class="s0">else </span><span class="s2">{</span>
                <span class="s1">expanded </span><span class="s2">= </span><span class="s1">urls</span><span class="s2">;</span>
            }

            <span class="s1">me</span><span class="s2">.</span><span class="s1">urls </span><span class="s2">= </span><span class="s1">expanded</span><span class="s2">;</span>

            <span class="s4">// if we added some urls to the request to honor the indicated</span>
            // load order, the request needs to be sequential
            <span class="s0">if </span><span class="s2">(</span><span class="s1">urls</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!= </span><span class="s1">expanded</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">sequential </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
            }

            <span class="s0">return </span><span class="s1">me</span><span class="s2">;</span>
        },

        <span class="s1">getUrls</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">expandLoadOrder</span><span class="s2">();</span>
            <span class="s0">return this</span><span class="s2">.</span><span class="s1">urls</span><span class="s2">;</span>
        },

        <span class="s1">prepareUrl</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">url</span><span class="s2">) {</span>
            <span class="s0">if</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">prependBaseUrl</span><span class="s2">) {</span>
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">baseUrl </span><span class="s2">+ </span><span class="s1">url</span><span class="s2">;</span>
            }
            <span class="s0">return </span><span class="s1">url</span><span class="s2">;</span>
        },

        <span class="s1">getEntries</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">entries </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">entries</span><span class="s2">,</span>
                <span class="s1">loadOrderMap</span><span class="s2">, </span><span class="s1">item</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">, </span><span class="s1">urls</span><span class="s2">, </span><span class="s1">url</span><span class="s2">;</span>
            
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">entries</span><span class="s2">) {</span>
                <span class="s1">entries </span><span class="s2">= [];</span>
                <span class="s1">urls </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">getUrls</span><span class="s2">();</span>
                
                <span class="s4">// If we have loadOrder array then the map will be expanded by now</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadOrder</span><span class="s2">) {</span>
                    <span class="s1">loadOrderMap </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadOrderMap</span><span class="s2">;</span>
                }
                
                <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">urls</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">url </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">prepareUrl</span><span class="s2">(</span><span class="s1">urls</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
                    
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">loadOrderMap</span><span class="s2">) {</span>
                        <span class="s1">item </span><span class="s2">= </span><span class="s1">loadOrderMap</span><span class="s2">[</span><span class="s1">url</span><span class="s2">];</span>
                    }
                    
                    <span class="s1">entry </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">getEntry</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, {</span>
                        <span class="s1">buster</span><span class="s2">: </span><span class="s1">me</span><span class="s2">.</span><span class="s1">buster</span><span class="s2">,</span>
                        <span class="s1">charset</span><span class="s2">: </span><span class="s1">me</span><span class="s2">.</span><span class="s1">charset</span>
                    <span class="s2">}, </span><span class="s1">item </span><span class="s2">&amp;&amp; </span><span class="s1">item</span><span class="s2">.</span><span class="s1">canonicalPath</span><span class="s2">);</span>
                    
                    <span class="s1">entry</span><span class="s2">.</span><span class="s1">requests</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">me</span><span class="s2">);</span>
                    <span class="s1">entries</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">entry</span><span class="s2">);</span>
                }
                
                <span class="s1">me</span><span class="s2">.</span><span class="s1">entries </span><span class="s2">= </span><span class="s1">entries</span><span class="s2">;</span>
            }
            
            <span class="s0">return </span><span class="s1">entries</span><span class="s2">;</span>
        },

        <span class="s1">loadEntries</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">sync</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">entries </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">getEntries</span><span class="s2">(),</span>
                <span class="s1">len </span><span class="s2">= </span><span class="s1">entries</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                <span class="s1">start </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadStart </span><span class="s2">|| </span><span class="s3">0</span><span class="s2">,</span>
                <span class="s1">continueLoad</span><span class="s2">, </span><span class="s1">entries</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">, </span><span class="s1">i</span><span class="s2">;</span>

            <span class="s0">if</span><span class="s2">(</span><span class="s1">sync </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">sync </span><span class="s2">= </span><span class="s1">sync</span><span class="s2">;</span>
            }

            <span class="s1">me</span><span class="s2">.</span><span class="s1">loaded </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loaded </span><span class="s2">|| </span><span class="s3">0</span><span class="s2">;</span>
            <span class="s1">me</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">|| </span><span class="s1">len</span><span class="s2">;</span>

            <span class="s0">for</span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">start</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s1">entry </span><span class="s2">= </span><span class="s1">entries</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                <span class="s0">if</span><span class="s2">(!</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">loaded</span><span class="s2">) {</span>
                    <span class="s1">continueLoad </span><span class="s2">= </span><span class="s1">entries</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">load</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">sync</span><span class="s2">);</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">continueLoad </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                }
                <span class="s0">if</span><span class="s2">(!</span><span class="s1">continueLoad</span><span class="s2">) {</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">loadStart </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
                    <span class="s1">entry</span><span class="s2">.</span><span class="s1">onDone</span><span class="s2">(</span><span class="s0">function</span><span class="s2">(){</span>
                        <span class="s1">me</span><span class="s2">.</span><span class="s1">loadEntries</span><span class="s2">(</span><span class="s1">sync</span><span class="s2">);</span>
                    });
                    <span class="s0">break</span><span class="s2">;</span>
                }
            }
            <span class="s1">me</span><span class="s2">.</span><span class="s1">processLoadedEntries</span><span class="s2">();</span>
        },

        <span class="s1">processLoadedEntries</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">entries </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">getEntries</span><span class="s2">(),</span>
                <span class="s1">len </span><span class="s2">= </span><span class="s1">entries</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                <span class="s1">start </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">startIndex </span><span class="s2">|| </span><span class="s3">0</span><span class="s2">,</span>
                <span class="s1">i</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">;</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">done</span><span class="s2">) {</span>
                <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">start</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">entry </span><span class="s2">= </span><span class="s1">entries</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>

                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">loaded</span><span class="s2">) {</span>
                        <span class="s1">me</span><span class="s2">.</span><span class="s1">startIndex </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
                        <span class="s0">return</span><span class="s2">;</span>
                    }

                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">evaluated</span><span class="s2">) {</span>
                        <span class="s1">entry</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">();</span>
                    }

                    <span class="s0">if </span><span class="s2">(</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
                        <span class="s1">me</span><span class="s2">.</span><span class="s1">error </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                    }
                }
                <span class="s1">me</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">();</span>
            }
        },

        <span class="s1">notify</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">done</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">error </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">error</span><span class="s2">,</span>
                    <span class="s1">fn </span><span class="s2">= </span><span class="s1">me</span><span class="s2">[</span><span class="s1">error </span><span class="s2">? </span><span class="s3">'failure' </span><span class="s2">: </span><span class="s3">'success'</span><span class="s2">],</span>
                    <span class="s1">delay </span><span class="s2">= (</span><span class="s3">'delay' </span><span class="s0">in </span><span class="s1">me</span><span class="s2">)</span>
                        ? <span class="s1">me</span><span class="s2">.</span><span class="s1">delay</span>
                        <span class="s2">: (</span><span class="s1">error </span><span class="s2">? </span><span class="s3">1 </span><span class="s2">: </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">chainDelay</span><span class="s2">),</span>
                    <span class="s1">scope </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">scope </span><span class="s2">|| </span><span class="s1">me</span><span class="s2">;</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">done </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">fn</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">delay </span><span class="s2">=== </span><span class="s3">0 </span><span class="s2">|| </span><span class="s1">delay </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                        <span class="s4">// Free the stack (and defer the next script)</span>
                        <span class="s1">setTimeout</span><span class="s2">(</span><span class="s0">function </span><span class="s2">() {</span>
                            <span class="s1">fn</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">scope</span><span class="s2">, </span><span class="s1">me</span><span class="s2">);</span>
                        }, <span class="s1">delay</span><span class="s2">);</span>
                    } <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">fn</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">scope</span><span class="s2">, </span><span class="s1">me</span><span class="s2">);</span>
                    }
                }
                <span class="s1">me</span><span class="s2">.</span><span class="s1">fireListeners</span><span class="s2">();</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">requestComplete</span><span class="s2">(</span><span class="s1">me</span><span class="s2">);</span>
            }
        },

        <span class="s1">onDone</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">listener</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">listeners </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">|| (</span><span class="s1">me</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= []);</span>
            <span class="s0">if</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">done</span><span class="s2">) {</span>
                <span class="s1">listener</span><span class="s2">(</span><span class="s1">me</span><span class="s2">);</span>
            } <span class="s0">else </span><span class="s2">{</span>
                <span class="s1">listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">listener</span><span class="s2">);</span>
            }
        },

        <span class="s1">fireListeners</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">listeners </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">,</span>
                <span class="s1">listener</span><span class="s2">;</span>
            <span class="s0">if</span><span class="s2">(</span><span class="s1">listeners</span><span class="s2">) {</span>
<span class="s4">//                 _debug(&quot;firing request listeners&quot;);</span>
                <span class="s0">while</span><span class="s2">((</span><span class="s1">listener </span><span class="s2">= </span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">())) {</span>
                    <span class="s1">listener</span><span class="s2">(</span><span class="s0">this</span><span class="s2">);</span>
                }
            }
        }
    };

    <span class="s0">function </span><span class="s1">Entry</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">) {</span>
         <span class="s4">//The Entry class is a token to manage the load and evaluation</span>
         //state of a particular url.  It is used to notify all Requests
         //interested in this url that the content is available.

        <span class="s0">if</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">$isEntry</span><span class="s2">) {</span>
            <span class="s0">return </span><span class="s1">cfg</span><span class="s2">;</span>
        }

<span class="s4">//         _debug(&quot;creating entry for &quot; + cfg.url);</span>

        <span class="s0">var </span><span class="s1">charset </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">charset </span><span class="s2">|| </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">charset</span><span class="s2">,</span>
            <span class="s1">manifest </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">,</span>
            <span class="s1">loader </span><span class="s2">= </span><span class="s1">manifest </span><span class="s2">&amp;&amp; </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">loader</span><span class="s2">,</span>
            <span class="s1">cache </span><span class="s2">= (</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">cache </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) ? </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">cache </span><span class="s2">: (</span><span class="s1">loader </span><span class="s2">&amp;&amp; </span><span class="s1">loader</span><span class="s2">.</span><span class="s1">cache</span><span class="s2">),</span>
            <span class="s1">buster</span><span class="s2">, </span><span class="s1">busterParam</span><span class="s2">;</span>

        <span class="s0">if </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">disableCaching</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">cache </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
                <span class="s1">cache </span><span class="s2">= !</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">disableCaching</span><span class="s2">;</span>
            }

            <span class="s0">if </span><span class="s2">(</span><span class="s1">cache </span><span class="s2">=== </span><span class="s0">false</span><span class="s2">) {</span>
                <span class="s1">buster </span><span class="s2">= +</span><span class="s0">new </span><span class="s1">Date</span><span class="s2">();</span>
            } <span class="s0">else if </span><span class="s2">(</span><span class="s1">cache </span><span class="s2">!== </span><span class="s0">true</span><span class="s2">) {</span>
                <span class="s1">buster </span><span class="s2">= </span><span class="s1">cache</span><span class="s2">;</span>
            }

            <span class="s0">if </span><span class="s2">(</span><span class="s1">buster</span><span class="s2">) {</span>
                <span class="s1">busterParam </span><span class="s2">= (</span><span class="s1">loader </span><span class="s2">&amp;&amp; </span><span class="s1">loader</span><span class="s2">.</span><span class="s1">cacheParam</span><span class="s2">) || </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">disableCachingParam</span><span class="s2">;</span>
                <span class="s1">buster </span><span class="s2">= </span><span class="s1">busterParam </span><span class="s2">+ </span><span class="s3">&quot;=&quot; </span><span class="s2">+ </span><span class="s1">buster</span><span class="s2">;</span>
            }
        }

        <span class="s1">_apply</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">);</span>
        
        <span class="s0">this</span><span class="s2">.</span><span class="s1">charset </span><span class="s2">= </span><span class="s1">charset</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">buster </span><span class="s2">= </span><span class="s1">buster</span><span class="s2">;</span>
        <span class="s0">this</span><span class="s2">.</span><span class="s1">requests </span><span class="s2">= [];</span>
    };
    
    <span class="s1">Entry</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= {</span>
        <span class="s1">$isEntry</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>
        <span class="s1">done</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>
        <span class="s1">evaluated</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>
        <span class="s1">loaded</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>

        <span class="s1">isCrossDomain</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>
            <span class="s0">if</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">crossDomain </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
<span class="s4">//                 _debug(&quot;checking &quot; + me.getLoadUrl() + &quot; for prefix &quot; + Boot.origin);</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">crossDomain </span><span class="s2">= (</span><span class="s1">me</span><span class="s2">.</span><span class="s1">getLoadUrl</span><span class="s2">().</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">origin</span><span class="s2">) !== </span><span class="s3">0</span><span class="s2">);</span>
            }
            <span class="s0">return </span><span class="s1">me</span><span class="s2">.</span><span class="s1">crossDomain</span><span class="s2">;</span>
        },

        <span class="s1">isCss</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">css </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">url</span><span class="s2">) {</span>
                    <span class="s0">var </span><span class="s1">assetConfig </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">[</span><span class="s1">me</span><span class="s2">.</span><span class="s1">url</span><span class="s2">];</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">css </span><span class="s2">= </span><span class="s1">assetConfig </span><span class="s2">? </span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s3">&quot;css&quot; </span><span class="s2">: </span><span class="s1">cssRe</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">url</span><span class="s2">);</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">css </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                }
            }
            <span class="s0">return this</span><span class="s2">.</span><span class="s1">css</span><span class="s2">;</span>
        },

        <span class="s1">getElement</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">tag</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">el </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">el</span><span class="s2">;</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">el</span><span class="s2">) {</span>
<span class="s4">//                 _debug(&quot;creating element for &quot; + me.url);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">isCss</span><span class="s2">()) {</span>
                    <span class="s1">tag </span><span class="s2">= </span><span class="s1">tag </span><span class="s2">|| </span><span class="s3">&quot;link&quot;</span><span class="s2">;</span>
                    <span class="s1">el </span><span class="s2">= </span><span class="s1">doc</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s1">tag</span><span class="s2">);</span>
                    <span class="s0">if</span><span class="s2">(</span><span class="s1">tag </span><span class="s2">== </span><span class="s3">&quot;link&quot;</span><span class="s2">) {</span>
                        <span class="s1">el</span><span class="s2">.</span><span class="s1">rel </span><span class="s2">= </span><span class="s3">'stylesheet'</span><span class="s2">;</span>
                        <span class="s1">me</span><span class="s2">.</span><span class="s1">prop </span><span class="s2">= </span><span class="s3">'href'</span><span class="s2">;</span>
                    } <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">me</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">=</span><span class="s3">&quot;textContent&quot;</span><span class="s2">;</span>
                    }
                    <span class="s1">el</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s3">&quot;text/css&quot;</span><span class="s2">;</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">tag </span><span class="s2">= </span><span class="s1">tag </span><span class="s2">|| </span><span class="s3">&quot;script&quot;</span><span class="s2">;</span>
                    <span class="s1">el </span><span class="s2">= </span><span class="s1">doc</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s1">tag</span><span class="s2">);</span>
                    <span class="s1">el</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s3">'text/javascript'</span><span class="s2">;</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">prop </span><span class="s2">= </span><span class="s3">'src'</span><span class="s2">;</span>

                    <span class="s0">if </span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">charset</span><span class="s2">) {</span>
                        <span class="s1">el</span><span class="s2">.</span><span class="s1">charset </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">charset</span><span class="s2">;</span>
                    }

                    <span class="s0">if </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasAsync</span><span class="s2">) {</span>
                        <span class="s1">el</span><span class="s2">.</span><span class="s1">async </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    }
                }
                <span class="s1">me</span><span class="s2">.</span><span class="s1">el </span><span class="s2">= </span><span class="s1">el</span><span class="s2">;</span>
            }
            <span class="s0">return </span><span class="s1">el</span><span class="s2">;</span>
        },

        <span class="s1">getLoadUrl</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">url</span><span class="s2">;</span>
            
            <span class="s1">url </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">canonicalPath </span><span class="s2">? </span><span class="s1">me</span><span class="s2">.</span><span class="s1">url </span><span class="s2">: </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">canonicalUrl</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">url</span><span class="s2">);</span>
            
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadUrl</span><span class="s2">) {</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">loadUrl </span><span class="s2">= !!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">buster</span>
                    <span class="s2">? (</span><span class="s1">url </span><span class="s2">+ (</span><span class="s1">url</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s3">'?'</span><span class="s2">) === -</span><span class="s3">1 </span><span class="s2">? </span><span class="s3">'?' </span><span class="s2">: </span><span class="s3">'&amp;'</span><span class="s2">) + </span><span class="s1">me</span><span class="s2">.</span><span class="s1">buster</span><span class="s2">)</span>
                    : <span class="s1">url</span><span class="s2">;</span>
            }
            <span class="s0">return </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadUrl</span><span class="s2">;</span>
        },

        <span class="s1">fetch</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">req</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">url </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getLoadUrl</span><span class="s2">(),</span>
                <span class="s1">async </span><span class="s2">= !!</span><span class="s1">req</span><span class="s2">.</span><span class="s1">async</span><span class="s2">,</span>
                <span class="s1">complete </span><span class="s2">= </span><span class="s1">req</span><span class="s2">.</span><span class="s1">complete</span><span class="s2">;</span>

            <span class="s1">Boot</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">complete</span><span class="s2">, </span><span class="s0">this</span><span class="s2">, </span><span class="s1">async</span><span class="s2">);</span>
        },

        <span class="s1">onContentLoaded</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">response</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">status </span><span class="s2">= </span><span class="s1">response</span><span class="s2">.</span><span class="s1">status</span><span class="s2">,</span>
                <span class="s1">content </span><span class="s2">= </span><span class="s1">response</span><span class="s2">.</span><span class="s1">content</span><span class="s2">,</span>
                <span class="s1">exception </span><span class="s2">= </span><span class="s1">response</span><span class="s2">.</span><span class="s1">exception</span><span class="s2">,</span>
                <span class="s1">url </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">getLoadUrl</span><span class="s2">();</span>
            <span class="s1">me</span><span class="s2">.</span><span class="s1">loaded </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
            <span class="s0">if </span><span class="s2">((</span><span class="s1">exception </span><span class="s2">|| </span><span class="s1">status </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) &amp;&amp; !</span><span class="s1">_environment</span><span class="s2">.</span><span class="s1">phantom</span><span class="s2">) {</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">error </span><span class="s2">=</span>
                    (<span class="s3">&quot;Failed loading synchronously via XHR: '&quot; </span><span class="s2">+ </span><span class="s1">url </span><span class="s2">+</span>
                        <span class="s3">&quot;'. It's likely that the file is either being loaded from a &quot; </span><span class="s2">+</span>
                        <span class="s3">&quot;different domain or from the local file system where cross &quot; </span><span class="s2">+</span>
                        <span class="s3">&quot;origin requests are not allowed for security reasons. Try &quot; </span><span class="s2">+</span>
                        <span class="s3">&quot;asynchronous loading instead.&quot;</span><span class="s2">) ||</span>
                    <span class="s0">true</span><span class="s2">;</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluated </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
            }
            <span class="s0">else if </span><span class="s2">((</span><span class="s1">status </span><span class="s2">&gt;= </span><span class="s3">200 </span><span class="s2">&amp;&amp; </span><span class="s1">status </span><span class="s2">&lt; </span><span class="s3">300</span><span class="s2">) || </span><span class="s1">status </span><span class="s2">=== </span><span class="s3">304</span>
                <span class="s2">|| </span><span class="s1">_environment</span><span class="s2">.</span><span class="s1">phantom</span>
                <span class="s2">|| (</span><span class="s1">status </span><span class="s2">=== </span><span class="s3">0 </span><span class="s2">&amp;&amp; </span><span class="s1">content</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">)</span>
                ) {
                <span class="s1">me</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">content</span><span class="s2">;</span>
            }
            <span class="s0">else </span><span class="s2">{</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">error </span><span class="s2">=</span>
                    (<span class="s3">&quot;Failed loading synchronously via XHR: '&quot; </span><span class="s2">+ </span><span class="s1">url </span><span class="s2">+</span>
                        <span class="s3">&quot;'. Please verify that the file exists. XHR status code: &quot; </span><span class="s2">+</span>
                        <span class="s1">status</span><span class="s2">) ||</span>
                    <span class="s0">true</span><span class="s2">;</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluated </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
            }
        },

        <span class="s1">createLoadElement</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">callback</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">el </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">getElement</span><span class="s2">();</span>
            
            <span class="s1">me</span><span class="s2">.</span><span class="s1">preserve </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
            
            <span class="s1">el</span><span class="s2">.</span><span class="s1">onerror </span><span class="s2">= </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">error </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                
                <span class="s0">if </span><span class="s2">(</span><span class="s1">callback</span><span class="s2">) {</span>
                    <span class="s1">callback</span><span class="s2">();</span>
                    <span class="s1">callback </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                }
            };
            
            <span class="s0">if </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10m</span><span class="s2">) {</span>
                <span class="s1">el</span><span class="s2">.</span><span class="s1">onreadystatechange </span><span class="s2">= </span><span class="s0">function</span><span class="s2">() {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">readyState </span><span class="s2">=== </span><span class="s3">'loaded' </span><span class="s2">|| </span><span class="s0">this</span><span class="s2">.</span><span class="s1">readyState </span><span class="s2">=== </span><span class="s3">'complete'</span><span class="s2">) {</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">callback</span><span class="s2">) {</span>
                            <span class="s1">callback</span><span class="s2">();</span>
                            <span class="s1">callback </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">onreadystatechange </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">onerror </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                        }
                    }
                };
            }
            <span class="s0">else </span><span class="s2">{</span>
                <span class="s1">el</span><span class="s2">.</span><span class="s1">onload </span><span class="s2">= </span><span class="s0">function</span><span class="s2">() {</span>
                    <span class="s1">callback</span><span class="s2">();</span>
                    <span class="s1">callback </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">onload </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">onerror </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                };
            }
            
            <span class="s4">// IE starts loading here</span>
            <span class="s1">el</span><span class="s2">[</span><span class="s1">me</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">] = </span><span class="s1">me</span><span class="s2">.</span><span class="s1">getLoadUrl</span><span class="s2">();</span>
        },

        <span class="s1">onLoadElementReady</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s1">Boot</span><span class="s2">.</span><span class="s1">getHead</span><span class="s2">().</span><span class="s1">appendChild</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">getElement</span><span class="s2">());</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">evaluated </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
        },

        <span class="s1">inject</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">content</span><span class="s2">, </span><span class="s1">asset</span><span class="s2">) {</span>
<span class="s4">//             _debug(&quot;injecting content for &quot; + this.url);</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">head </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">getHead</span><span class="s2">(),</span>
                <span class="s1">url </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">url</span><span class="s2">,</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">key</span><span class="s2">,</span>
                <span class="s1">base</span><span class="s2">, </span><span class="s1">el</span><span class="s2">, </span><span class="s1">ieMode</span><span class="s2">, </span><span class="s1">basePath</span><span class="s2">;</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">isCss</span><span class="s2">()) {</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">preserve </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s1">basePath </span><span class="s2">= </span><span class="s1">key</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">key</span><span class="s2">.</span><span class="s1">lastIndexOf</span><span class="s2">(</span><span class="s3">&quot;/&quot;</span><span class="s2">) + </span><span class="s3">1</span><span class="s2">);</span>
                <span class="s1">base </span><span class="s2">= </span><span class="s1">doc</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s3">'base'</span><span class="s2">);</span>
                <span class="s1">base</span><span class="s2">.</span><span class="s1">href </span><span class="s2">= </span><span class="s1">basePath</span><span class="s2">;</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">head</span><span class="s2">.</span><span class="s1">firstChild</span><span class="s2">) {</span>
                    <span class="s1">head</span><span class="s2">.</span><span class="s1">insertBefore</span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s1">head</span><span class="s2">.</span><span class="s1">firstChild</span><span class="s2">);</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">head</span><span class="s2">.</span><span class="s1">appendChild</span><span class="s2">(</span><span class="s1">base</span><span class="s2">);</span>
                }
                <span class="s4">// reset the href attribute to cuase IE to pick up the change</span>
                <span class="s1">base</span><span class="s2">.</span><span class="s1">href </span><span class="s2">= </span><span class="s1">base</span><span class="s2">.</span><span class="s1">href</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">url</span><span class="s2">) {</span>
                    <span class="s1">content </span><span class="s2">+= </span><span class="s3">&quot;\n/*# sourceURL=&quot; </span><span class="s2">+ </span><span class="s1">key </span><span class="s2">+ </span><span class="s3">&quot; */&quot;</span><span class="s2">;</span>
                }

                <span class="s4">// create element after setting base</span>
                <span class="s1">el </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">getElement</span><span class="s2">(</span><span class="s3">&quot;style&quot;</span><span class="s2">);</span>

                <span class="s1">ieMode </span><span class="s2">= (</span><span class="s3">'styleSheet' </span><span class="s0">in </span><span class="s1">el</span><span class="s2">);</span>

                <span class="s1">head</span><span class="s2">.</span><span class="s1">appendChild</span><span class="s2">(</span><span class="s1">base</span><span class="s2">);</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">ieMode</span><span class="s2">) {</span>
                    <span class="s1">head</span><span class="s2">.</span><span class="s1">appendChild</span><span class="s2">(</span><span class="s1">el</span><span class="s2">);</span>
                    <span class="s1">el</span><span class="s2">.</span><span class="s1">styleSheet</span><span class="s2">.</span><span class="s1">cssText </span><span class="s2">= </span><span class="s1">content</span><span class="s2">;</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">el</span><span class="s2">.</span><span class="s1">textContent </span><span class="s2">= </span><span class="s1">content</span><span class="s2">;</span>
                    <span class="s1">head</span><span class="s2">.</span><span class="s1">appendChild</span><span class="s2">(</span><span class="s1">el</span><span class="s2">);</span>
                }
                <span class="s1">head</span><span class="s2">.</span><span class="s1">removeChild</span><span class="s2">(</span><span class="s1">base</span><span class="s2">);</span>

            } <span class="s0">else </span><span class="s2">{</span>
                <span class="s4">// Debugger friendly, file names are still shown even though they're</span>
                // eval'ed code. Breakpoints work on both Firebug and Chrome's Web
                // Inspector.
                <span class="s0">if </span><span class="s2">(</span><span class="s1">url</span><span class="s2">) {</span>
                    <span class="s1">content </span><span class="s2">+= </span><span class="s3">&quot;\n//# sourceURL=&quot; </span><span class="s2">+ </span><span class="s1">key</span><span class="s2">;</span>
                }
                <span class="s1">Ext</span><span class="s2">.</span><span class="s1">globalEval</span><span class="s2">(</span><span class="s1">content</span><span class="s2">);</span>
            }
            <span class="s0">return </span><span class="s1">me</span><span class="s2">;</span>
        },

        <span class="s1">loadCrossDomain</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">complete </span><span class="s2">= </span><span class="s0">function</span><span class="s2">(){</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">el</span><span class="s2">.</span><span class="s1">onerror </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">el</span><span class="s2">.</span><span class="s1">onload </span><span class="s2">= </span><span class="s1">emptyFn</span><span class="s2">;</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">el </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">loaded </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">evaluated </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">done </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">notifyRequests</span><span class="s2">();</span>
                };
            <span class="s1">me</span><span class="s2">.</span><span class="s1">createLoadElement</span><span class="s2">(</span><span class="s0">function</span><span class="s2">(){</span>
                <span class="s1">complete</span><span class="s2">();</span>
            });
            <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluateLoadElement</span><span class="s2">();</span>
            <span class="s4">// at this point, we need sequential evaluation,</span>
            // which means we can't advance the load until
            // this entry has fully completed
            <span class="s0">return false</span><span class="s2">;</span>
        },

        <span class="s1">loadElement</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">complete </span><span class="s2">= </span><span class="s0">function</span><span class="s2">(){</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">el</span><span class="s2">.</span><span class="s1">onerror </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">el</span><span class="s2">.</span><span class="s1">onload </span><span class="s2">= </span><span class="s1">emptyFn</span><span class="s2">;</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">el </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">loaded </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">evaluated </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">done </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">notifyRequests</span><span class="s2">();</span>
                };
            <span class="s1">me</span><span class="s2">.</span><span class="s1">createLoadElement</span><span class="s2">(</span><span class="s0">function</span><span class="s2">(){</span>
                <span class="s1">complete</span><span class="s2">();</span>
            });
            <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluateLoadElement</span><span class="s2">();</span>
            <span class="s0">return true</span><span class="s2">;</span>
        },

        <span class="s1">loadSync</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>
            <span class="s1">me</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">({</span>
                <span class="s1">async</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>
                <span class="s1">complete</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">response</span><span class="s2">) {</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">onContentLoaded</span><span class="s2">(</span><span class="s1">response</span><span class="s2">);</span>
                }
            });
            <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluate</span><span class="s2">();</span>
            <span class="s1">me</span><span class="s2">.</span><span class="s1">notifyRequests</span><span class="s2">();</span>
        },

        <span class="s1">load</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">sync</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>
            <span class="s0">if </span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">loaded</span><span class="s2">) {</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">loading</span><span class="s2">) {</span>
                    <span class="s4">// if we're calling back through load and we're loading but haven't</span>
                    // yet loaded, then we should be in a sequential, cross domain
                    // load scenario which means we can't continue the load on the
                    // request until this entry has fully evaluated, which will mean
                    // loaded = evaluated = done = true in one step.  For css files, this
                    // will happen immediately upon &lt;link&gt; element creation / insertion,
                    // but &lt;script&gt; elements will set this upon load notification
                    <span class="s0">return false</span><span class="s2">;</span>
                }
                <span class="s1">me</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>

                <span class="s4">// for async modes, we have some options</span>
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">sync</span><span class="s2">) {</span>
                    <span class="s4">// if cross domain, just inject the script tag and let the onload</span>
                    // events drive the progression.
                    // IE10 also needs sequential loading because of a bug that makes it
                    // fire readystate event prematurely:
                    // https://connect.microsoft.com/IE/feedback/details/729164/ie10-dynamic-script-element-fires-loaded-readystate-prematurely
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">isIE10 </span><span class="s2">|| </span><span class="s1">me</span><span class="s2">.</span><span class="s1">isCrossDomain</span><span class="s2">()) {</span>
                        <span class="s0">return </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadCrossDomain</span><span class="s2">();</span>
                    }
                    <span class="s4">// for IE, use the readyStateChange allows us to load scripts in parallel</span>
                    // but serialize the evaluation by appending the script node to the
                    // document
                    <span class="s0">else if</span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">isCss</span><span class="s2">() &amp;&amp; </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">hasReadyState</span><span class="s2">) {</span>
                        <span class="s1">me</span><span class="s2">.</span><span class="s1">createLoadElement</span><span class="s2">(</span><span class="s0">function </span><span class="s2">() {</span>
                            <span class="s1">me</span><span class="s2">.</span><span class="s1">loaded </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                            <span class="s1">me</span><span class="s2">.</span><span class="s1">notifyRequests</span><span class="s2">();</span>
                        });
                    }

                    <span class="s0">else if</span><span class="s2">(</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">useElements </span><span class="s2">&amp;&amp;</span>
                        <span class="s4">// older webkit, phantomjs included, won't fire load for link elements</span>
                        <span class="s2">!(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">isCss</span><span class="s2">() &amp;&amp; </span><span class="s1">_environment</span><span class="s2">.</span><span class="s1">phantom</span><span class="s2">)) {</span>
                        <span class="s0">return </span><span class="s1">me</span><span class="s2">.</span><span class="s1">loadElement</span><span class="s2">();</span>
                    }
                    <span class="s4">// for other browsers, just ajax the content down in parallel, and use</span>
                    // globalEval to serialize evaluation
                    <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">me</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">({</span>
                            <span class="s1">async</span><span class="s2">: !</span><span class="s1">sync</span><span class="s2">,</span>
                            <span class="s1">complete</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">response</span><span class="s2">) {</span>
                                <span class="s1">me</span><span class="s2">.</span><span class="s1">onContentLoaded</span><span class="s2">(</span><span class="s1">response</span><span class="s2">);</span>
                                <span class="s1">me</span><span class="s2">.</span><span class="s1">notifyRequests</span><span class="s2">();</span>
                            }
                        });
                    }
                }

                <span class="s4">// for sync mode in js, global eval FTW.  IE won't honor the comment</span>
                // paths in the debugger, so eventually we need a sync mode for IE that
                // uses the readyStateChange mechanism
                <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">loadSync</span><span class="s2">();</span>
                }
            }
            <span class="s4">// signal that the load process can continue</span>
            <span class="s0">return true</span><span class="s2">;</span>
        },

        <span class="s1">evaluateContent</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">inject</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
        },

        <span class="s1">evaluateLoadElement</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s1">Boot</span><span class="s2">.</span><span class="s1">getHead</span><span class="s2">().</span><span class="s1">appendChild</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">getElement</span><span class="s2">());</span>
        },

        <span class="s1">evaluate</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>
            <span class="s0">if</span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">evaluated</span><span class="s2">) {</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">evaluating</span><span class="s2">) {</span>
                    <span class="s0">return</span><span class="s2">;</span>
                }
                <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluating </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">content </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluateContent</span><span class="s2">();</span>
                } <span class="s0">else if</span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
                    <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluateLoadElement</span><span class="s2">();</span>
                }
                <span class="s1">me</span><span class="s2">.</span><span class="s1">evaluated </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">done </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">cleanup</span><span class="s2">();</span>
            }
        },

        <span class="s1">cleanup</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">el </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">el</span><span class="s2">,</span>
                <span class="s1">prop</span><span class="s2">;</span>

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">el</span><span class="s2">) {</span>
                <span class="s0">return</span><span class="s2">;</span>
            }

            <span class="s0">if </span><span class="s2">(!</span><span class="s1">me</span><span class="s2">.</span><span class="s1">preserve</span><span class="s2">) {</span>
                <span class="s1">me</span><span class="s2">.</span><span class="s1">el </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>

                <span class="s1">el</span><span class="s2">.</span><span class="s1">parentNode</span><span class="s2">.</span><span class="s1">removeChild</span><span class="s2">(</span><span class="s1">el</span><span class="s2">); </span><span class="s4">// Remove, since its useless now</span>

                <span class="s0">for </span><span class="s2">(</span><span class="s1">prop </span><span class="s0">in </span><span class="s1">el</span><span class="s2">) {</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">prop </span><span class="s2">!== </span><span class="s1">me</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">) {</span>
                            <span class="s4">// If we set the src property to null IE</span>
                            // will try and request a script at './null'
                            <span class="s1">el</span><span class="s2">[</span><span class="s1">prop</span><span class="s2">] = </span><span class="s0">null</span><span class="s2">;</span>
                        }
                        <span class="s0">delete </span><span class="s1">el</span><span class="s2">[</span><span class="s1">prop</span><span class="s2">];      </span><span class="s4">// and prepare for GC</span>
                    <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">cleanEx</span><span class="s2">) {</span>
                        <span class="s4">//ignore</span>
                    <span class="s2">}</span>
                }
            }

            <span class="s4">// Setting to null can cause exceptions if IE ever needs to call these</span>
            // again (like onreadystatechange). This emptyFn has nothing locked in
            // closure scope so it is about as safe as null for memory leaks.
            <span class="s1">el</span><span class="s2">.</span><span class="s1">onload </span><span class="s2">= </span><span class="s1">el</span><span class="s2">.</span><span class="s1">onerror </span><span class="s2">= </span><span class="s1">el</span><span class="s2">.</span><span class="s1">onreadystatechange </span><span class="s2">= </span><span class="s1">emptyFn</span><span class="s2">;</span>
        },

        <span class="s1">notifyRequests</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">requests </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">requests</span><span class="s2">,</span>
                <span class="s1">len </span><span class="s2">= </span><span class="s1">requests</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                <span class="s1">i</span><span class="s2">, </span><span class="s1">request</span><span class="s2">;</span>
            <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s1">request </span><span class="s2">= </span><span class="s1">requests</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                <span class="s1">request</span><span class="s2">.</span><span class="s1">processLoadedEntries</span><span class="s2">();</span>
            }
            <span class="s0">if</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">done</span><span class="s2">) {</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">fireListeners</span><span class="s2">();</span>
            }
        },

        <span class="s1">onDone</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">listener</span><span class="s2">) {</span>
            <span class="s0">var </span><span class="s1">me </span><span class="s2">= </span><span class="s0">this</span><span class="s2">,</span>
                <span class="s1">listeners </span><span class="s2">= </span><span class="s1">me</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">|| (</span><span class="s1">me</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= []);</span>
            <span class="s0">if</span><span class="s2">(</span><span class="s1">me</span><span class="s2">.</span><span class="s1">done</span><span class="s2">) {</span>
                <span class="s1">listener</span><span class="s2">(</span><span class="s1">me</span><span class="s2">);</span>
            } <span class="s0">else </span><span class="s2">{</span>
                <span class="s1">listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">listener</span><span class="s2">);</span>
            }
        },

        <span class="s1">fireListeners</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
            <span class="s0">var </span><span class="s1">listeners </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">,</span>
                <span class="s1">listener</span><span class="s2">;</span>
            <span class="s0">if</span><span class="s2">(</span><span class="s1">listeners </span><span class="s2">&amp;&amp; </span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
<span class="s4">//                 _debug(&quot;firing event listeners for url &quot; + this.url);</span>
                <span class="s0">while</span><span class="s2">((</span><span class="s1">listener </span><span class="s2">= </span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">())) {</span>
                    <span class="s1">listener</span><span class="s2">(</span><span class="s0">this</span><span class="s2">);</span>
                }
            }
        }
    };

    <span class="s4">/**</span>
     * Turns on or off the &quot;cache buster&quot; applied to dynamically loaded scripts. Normally
     * dynamically loaded scripts have an extra query parameter appended to avoid stale
     * cached scripts. This method can be used to disable this mechanism, and is primarily
     * useful for testing. This is done using a cookie.
     * @param {Boolean} disable True to disable the cache buster.
     * @param {String} [path=&quot;/&quot;] An optional path to scope the cookie.
     */
    <span class="s1">Ext</span><span class="s2">.</span><span class="s1">disableCacheBuster </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">disable</span><span class="s2">, </span><span class="s1">path</span><span class="s2">) {</span>
        <span class="s0">var </span><span class="s1">date </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Date</span><span class="s2">();</span>
        <span class="s1">date</span><span class="s2">.</span><span class="s1">setTime</span><span class="s2">(</span><span class="s1">date</span><span class="s2">.</span><span class="s1">getTime</span><span class="s2">() + (</span><span class="s1">disable </span><span class="s2">? </span><span class="s3">10 </span><span class="s2">* </span><span class="s3">365 </span><span class="s2">: -</span><span class="s3">1</span><span class="s2">) * </span><span class="s3">24 </span><span class="s2">* </span><span class="s3">60 </span><span class="s2">* </span><span class="s3">60 </span><span class="s2">* </span><span class="s3">1000</span><span class="s2">);</span>
        <span class="s1">date </span><span class="s2">= </span><span class="s1">date</span><span class="s2">.</span><span class="s1">toGMTString</span><span class="s2">();</span>
        <span class="s1">doc</span><span class="s2">.</span><span class="s1">cookie </span><span class="s2">= </span><span class="s3">'ext-cache=1; expires=' </span><span class="s2">+ </span><span class="s1">date </span><span class="s2">+ </span><span class="s3">'; path=' </span><span class="s2">+ (</span><span class="s1">path </span><span class="s2">|| </span><span class="s3">'/'</span><span class="s2">);</span>
    };


    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">init</span><span class="s2">();</span>
    <span class="s0">return </span><span class="s1">Boot</span><span class="s2">;</span>

<span class="s4">// NOTE: We run the eval at global scope to protect the body of the function and allow</span>
// compressors to still process it.
<span class="s2">}(</span><span class="s0">function </span><span class="s2">() {</span>
}));<span class="s4">//(eval(&quot;/*@cc_on!@*/!1&quot;));</span>

/**
 * This method evaluates the given code free of any local variable. This
 * will be at global scope, in others it will be in a function.
 * @param {String} code The code to evaluate.
 * @private
 * @method
 * @member Ext
 */
<span class="s1">Ext</span><span class="s2">.</span><span class="s1">globalEval </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">globalEval </span><span class="s2">|| (</span><span class="s0">this</span><span class="s2">.</span><span class="s1">execScript</span>
    <span class="s2">? </span><span class="s0">function </span><span class="s2">(</span><span class="s1">code</span><span class="s2">) { </span><span class="s1">execScript</span><span class="s2">(</span><span class="s1">code</span><span class="s2">); }</span>
    : <span class="s0">function </span><span class="s2">(</span><span class="s1">$$code</span><span class="s2">) { </span><span class="s1">eval</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">window</span><span class="s2">, </span><span class="s1">$$code</span><span class="s2">); });</span>

<span class="s6">/* 
<a name="l18"><span class="ln">18   </span></a> * Only IE8 &amp; IE/Quirks lack Function.prototype.bind so we polyfill that here. 
<a name="l19"><span class="ln">19   </span></a> */</span>
<span class="s0">if </span><span class="s2">(!</span><span class="s1">Function</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">) {</span>
    (<span class="s0">function </span><span class="s2">() {</span>
        <span class="s0">var </span><span class="s1">slice </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">,</span>
        <span class="s4">// To reduce overhead on call of the bound fn we have two flavors based on</span>
        // whether we have args to prepend or not:
            <span class="s1">bind </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">me</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s3">1</span><span class="s2">),</span>
                    <span class="s1">method </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">args</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
                    <span class="s0">return function </span><span class="s2">() {</span>
                        <span class="s0">var </span><span class="s1">t </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">;</span>
                        <span class="s4">// avoid the slice/concat if the caller does not supply args</span>
                        <span class="s0">return </span><span class="s1">method</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">me</span><span class="s2">, </span><span class="s1">t</span><span class="s2">.</span><span class="s1">length </span><span class="s2">? </span><span class="s1">args</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">t</span><span class="s2">)) : </span><span class="s1">args</span><span class="s2">);</span>
                    };
                }
                <span class="s4">// this is the majority use case - just fn.bind(this) and no args</span>

                <span class="s1">args </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                <span class="s0">return function </span><span class="s2">() {</span>
                    <span class="s0">return </span><span class="s1">method</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">me</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
                };
            };
        <span class="s1">Function</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s1">bind</span><span class="s2">;</span>
        <span class="s1">bind</span><span class="s2">.</span><span class="s1">$extjs </span><span class="s2">= </span><span class="s0">true</span><span class="s2">; </span><span class="s4">// to detect this polyfill if one want to improve it</span>
    <span class="s2">}());</span>
}

<span class="s4">//&lt;/editor-fold&gt;</span>

<span class="s1">Ext</span><span class="s2">.</span><span class="s1">setResourcePath </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">poolName</span><span class="s2">, </span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s0">var </span><span class="s1">manifest </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">|| (</span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">= {}),</span>
        <span class="s1">paths </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">resources </span><span class="s2">|| (</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">resources </span><span class="s2">= {});</span>

    <span class="s0">if </span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">) {</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">poolName </span><span class="s2">!== </span><span class="s3">'string'</span><span class="s2">) {</span>
            <span class="s1">Ext</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">paths</span><span class="s2">, </span><span class="s1">poolName</span><span class="s2">);</span>
        } <span class="s0">else </span><span class="s2">{</span>
            <span class="s1">paths</span><span class="s2">[</span><span class="s1">poolName</span><span class="s2">] = </span><span class="s1">path</span><span class="s2">;</span>
        }
        <span class="s1">manifest</span><span class="s2">.</span><span class="s1">resources </span><span class="s2">= </span><span class="s1">paths</span><span class="s2">;</span>
    }
};

<span class="s1">Ext</span><span class="s2">.</span><span class="s1">getResourcePath </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">poolName</span><span class="s2">, </span><span class="s1">packageName</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">path </span><span class="s2">!== </span><span class="s3">'string'</span><span class="s2">) {</span>
        <span class="s1">poolName </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">pool</span><span class="s2">;</span>
        <span class="s1">packageName </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">packageName</span><span class="s2">;</span>
        <span class="s1">path </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">path</span><span class="s2">;</span>
    }
    <span class="s0">var </span><span class="s1">manifest </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">,</span>
        <span class="s1">paths </span><span class="s2">= </span><span class="s1">manifest </span><span class="s2">&amp;&amp; </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">resources</span><span class="s2">,</span>
        <span class="s1">poolPath </span><span class="s2">= </span><span class="s1">paths</span><span class="s2">[</span><span class="s1">poolName</span><span class="s2">],</span>
        <span class="s1">output </span><span class="s2">= [];</span>

    <span class="s0">if </span><span class="s2">(</span><span class="s1">poolPath </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) {</span>
        <span class="s1">poolPath </span><span class="s2">= </span><span class="s1">paths</span><span class="s2">.</span><span class="s1">path</span><span class="s2">;</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s1">poolPath </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) {</span>
            <span class="s1">poolPath </span><span class="s2">= </span><span class="s3">'resources'</span><span class="s2">;</span>
        }
    }

    <span class="s0">if </span><span class="s2">(</span><span class="s1">poolPath</span><span class="s2">) {</span>
        <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">poolPath</span><span class="s2">);</span>
    }

    <span class="s0">if </span><span class="s2">(</span><span class="s1">packageName</span><span class="s2">) {</span>
        <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">packageName</span><span class="s2">);</span>
    }

    <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>
    <span class="s0">return </span><span class="s1">output</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">'/'</span><span class="s2">);</span>
};
<span class="s4">// here, the extra check for window['Ext'] is needed for use with cmd-test</span>
// code injection.  we need to make that this file will sync up with page global
// scope to avoid duplicate Ext.Boot state.  That check is after the initial Ext check
// to allow the sandboxing template to inject an appropriate Ext var and prevent the
// global detection.
<span class="s0">var </span><span class="s1">Ext </span><span class="s2">= </span><span class="s1">Ext </span><span class="s2">|| </span><span class="s1">window</span><span class="s2">[</span><span class="s3">'Ext'</span><span class="s2">] || {};</span>


<span class="s4">//&lt;editor-fold desc=&quot;Microloader&quot;&gt;</span>
/**
 * @class Ext.Microloader
 * @private
 * @singleton
 */
<span class="s1">Ext</span><span class="s2">.</span><span class="s1">Microloader </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">Microloader </span><span class="s2">|| (</span><span class="s0">function </span><span class="s2">() {</span>
    <span class="s0">var </span><span class="s1">Boot </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">Boot</span><span class="s2">,</span>
        <span class="s1">_debug </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">message</span><span class="s2">) {</span>
            <span class="s4">//console.log(message);</span>
        <span class="s2">},</span>
        <span class="s1">_warn </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">message</span><span class="s2">) {</span>
            <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s3">&quot;[WARN] &quot; </span><span class="s2">+ </span><span class="s1">message</span><span class="s2">);</span>
        },
        <span class="s1">_privatePrefix </span><span class="s2">= </span><span class="s3">'_ext:' </span><span class="s2">+ </span><span class="s1">location</span><span class="s2">.</span><span class="s1">pathname</span><span class="s2">,</span>

        <span class="s4">/**</span>
         * @method getStorageKey
         * The Following combination is used to create isolated local storage keys
         * '_ext' is used to scope all the local storage keys that we internally by Ext
         * 'location.pathname' is used to force each assets to cache by an absolute URL (/build/MyApp) (dev vs prod)
         * 'url' is used to force each asset to cache relative to the page (app.json vs resources/app.css)
         * 'profileId' is used to differentiate the builds of an application (neptune vs crisp)
         * 'Microloader.appId' is unique to the application and will differentiate apps on the same host (dev mode running app watch against multiple apps)
         */
        <span class="s1">getStorageKey </span><span class="s2">= </span><span class="s0">function</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">profileId</span><span class="s2">) {</span>
            <span class="s0">return  </span><span class="s1">_privatePrefix </span><span class="s2">+ </span><span class="s1">url </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ (</span><span class="s1">profileId </span><span class="s2">? </span><span class="s1">profileId </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">: </span><span class="s3">''</span><span class="s2">) + </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appId</span><span class="s2">;</span>
        },
        <span class="s1">postProcessor</span><span class="s2">, </span><span class="s1">_storage</span><span class="s2">;</span>

    <span class="s0">try </span><span class="s2">{</span>
        <span class="s1">_storage </span><span class="s2">= </span><span class="s1">window</span><span class="s2">[</span><span class="s3">'localStorage'</span><span class="s2">];</span>
    } <span class="s0">catch</span><span class="s2">(</span><span class="s1">ex</span><span class="s2">) {</span>
        <span class="s4">// ignore</span>
    <span class="s2">}</span>

    <span class="s0">var </span><span class="s1">_cache </span><span class="s2">= </span><span class="s1">window</span><span class="s2">[</span><span class="s3">'applicationCache'</span><span class="s2">],</span>
        <span class="s4">// Local Storage Controller</span>
        <span class="s1">LocalStorage </span><span class="s2">= {</span>
            <span class="s1">clearAllPrivate</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">) {</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">_storage</span><span class="s2">) {</span>

                    <span class="s4">//Remove the entry for the manifest first</span>
                    <span class="s1">_storage</span><span class="s2">.</span><span class="s1">removeItem</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">key</span><span class="s2">);</span>

                    <span class="s0">var </span><span class="s1">i</span><span class="s2">, </span><span class="s1">key</span><span class="s2">,</span>
                        <span class="s1">removeKeys </span><span class="s2">= [],</span>
                        <span class="s1">suffix </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">profile </span><span class="s2">+ </span><span class="s3">'-' </span><span class="s2">+ </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appId</span><span class="s2">,</span>
                        <span class="s1">ln </span><span class="s2">= </span><span class="s1">_storage</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">ln</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                        <span class="s1">key </span><span class="s2">= </span><span class="s1">_storage</span><span class="s2">.</span><span class="s1">key</span><span class="s2">(</span><span class="s1">i</span><span class="s2">);</span>
                        <span class="s4">// If key starts with the private key and the suffix is present we can clear this entry</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">key</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">_privatePrefix</span><span class="s2">) === </span><span class="s3">0 </span><span class="s2">&amp;&amp; </span><span class="s1">key</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">suffix</span><span class="s2">) !== -</span><span class="s3">1</span><span class="s2">) {</span>
                            <span class="s1">removeKeys</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>
                        }
                    }

                    <span class="s0">for</span><span class="s2">(</span><span class="s1">i </span><span class="s0">in </span><span class="s1">removeKeys</span><span class="s2">) {</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Removing &quot;</span><span class="s2">+ </span><span class="s1">removeKeys</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] + </span><span class="s3">&quot; from Local Storage&quot;</span><span class="s2">);</span>
                        <span class="s1">_storage</span><span class="s2">.</span><span class="s1">removeItem</span><span class="s2">(</span><span class="s1">removeKeys</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
                    }
                }
            },
            <span class="s4">/**</span>
             * @private
             */
            <span class="s1">retrieveAsset</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s0">return </span><span class="s1">_storage</span><span class="s2">.</span><span class="s1">getItem</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>
                }
                <span class="s0">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
                    <span class="s4">// Private browsing mode</span>
                    <span class="s0">return null</span><span class="s2">;</span>
                }
            },

            <span class="s1">setAsset</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">content</span><span class="s2">) {</span>
                <span class="s0">try </span><span class="s2">{</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">content </span><span class="s2">=== </span><span class="s0">null </span><span class="s2">|| </span><span class="s1">content </span><span class="s2">== </span><span class="s3">''</span><span class="s2">) {</span>
                        <span class="s1">_storage</span><span class="s2">.</span><span class="s1">removeItem</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>
                    } <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">_storage</span><span class="s2">.</span><span class="s1">setItem</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">content</span><span class="s2">);</span>
                    }
                }
                <span class="s0">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">_storage </span><span class="s2">&amp;&amp; </span><span class="s1">e</span><span class="s2">.</span><span class="s1">code </span><span class="s2">== </span><span class="s1">e</span><span class="s2">.</span><span class="s1">QUOTA_EXCEEDED_ERR</span><span class="s2">) {</span>
                        <span class="s1">_warn</span><span class="s2">(</span><span class="s3">&quot;LocalStorage Quota exceeded, cannot store &quot; </span><span class="s2">+ </span><span class="s1">key </span><span class="s2">+ </span><span class="s3">&quot; locally&quot;</span><span class="s2">);</span>
                    }
                }
            }
        };

        <span class="s0">var </span><span class="s1">Asset </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">assetConfig </span><span class="s2">=== </span><span class="s3">'string'</span><span class="s2">) {</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig </span><span class="s2">= {</span>
                    <span class="s1">path</span><span class="s2">: </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">assetConfig</span>
                <span class="s2">};</span>
            } <span class="s0">else </span><span class="s2">{</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">;</span>
            }

            <span class="s0">this</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">type</span><span class="s2">;</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">key </span><span class="s2">= </span><span class="s1">getStorageKey</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">profile</span><span class="s2">);</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">loadFromCache</span><span class="s2">) {</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">loadFromCache</span><span class="s2">();</span>
            }
        };

        <span class="s1">Asset</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= {</span>
            <span class="s1">shouldCache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s0">return </span><span class="s1">_storage </span><span class="s2">&amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">update </span><span class="s2">&amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">&amp;&amp; !</span><span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">remote</span><span class="s2">;</span>
            },

            <span class="s1">is</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">asset</span><span class="s2">) {</span>
                <span class="s0">return </span><span class="s2">(!!</span><span class="s1">asset </span><span class="s2">&amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig </span><span class="s2">&amp;&amp; </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig </span><span class="s2">&amp;&amp; (</span><span class="s0">this</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">=== </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">))</span>
            },

            <span class="s1">cache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">content</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">()) {</span>
                    <span class="s1">LocalStorage</span><span class="s2">.</span><span class="s1">setAsset</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">key</span><span class="s2">, </span><span class="s1">content </span><span class="s2">|| </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
                }
            },

            <span class="s1">uncache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s1">LocalStorage</span><span class="s2">.</span><span class="s1">setAsset</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">key</span><span class="s2">, </span><span class="s0">null</span><span class="s2">);</span>
            },

            <span class="s1">updateContent</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">content</span><span class="s2">) {</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">content</span><span class="s2">;</span>
            },

            <span class="s1">getSize</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">return this</span><span class="s2">.</span><span class="s1">content </span><span class="s2">? </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">length </span><span class="s2">: </span><span class="s3">0</span><span class="s2">;</span>
            },

            <span class="s1">loadFromCache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">()) {</span>
                    <span class="s0">this</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">LocalStorage</span><span class="s2">.</span><span class="s1">retrieveAsset</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">key</span><span class="s2">);</span>
                }
            }
        };

        <span class="s0">var </span><span class="s1">Manifest </span><span class="s2">= </span><span class="s0">function </span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">) {</span>
            <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">content </span><span class="s2">=== </span><span class="s3">&quot;string&quot;</span><span class="s2">) {</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
            } <span class="s0">else </span><span class="s2">{</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">content</span><span class="s2">;</span>
            }
            <span class="s0">this</span><span class="s2">.</span><span class="s1">assetMap </span><span class="s2">= {};</span>

            <span class="s0">this</span><span class="s2">.</span><span class="s1">url </span><span class="s2">= </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">url</span><span class="s2">;</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">fromCache </span><span class="s2">= !!</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">cached</span><span class="s2">;</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">assetCache </span><span class="s2">= !(</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">assetCache </span><span class="s2">=== </span><span class="s0">false</span><span class="s2">);</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">key </span><span class="s2">= </span><span class="s1">getStorageKey</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">url</span><span class="s2">);</span>

            <span class="s4">// Pull out select properties for repetitive use</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">profile </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">profile</span><span class="s2">;</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">;</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">loadOrder </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">loadOrder</span><span class="s2">;</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">deltas </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">cache </span><span class="s2">? </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">cache</span><span class="s2">.</span><span class="s1">deltas </span><span class="s2">: </span><span class="s0">null</span><span class="s2">;</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">cacheEnabled </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">cache </span><span class="s2">? </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">cache</span><span class="s2">.</span><span class="s1">enable </span><span class="s2">: </span><span class="s0">false</span><span class="s2">;</span>

            <span class="s0">this</span><span class="s2">.</span><span class="s1">loadOrderMap </span><span class="s2">= (</span><span class="s0">this</span><span class="s2">.</span><span class="s1">loadOrder</span><span class="s2">) ? </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">createLoadOrderMap</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">loadOrder</span><span class="s2">) : </span><span class="s0">null</span><span class="s2">;</span>

            <span class="s0">var </span><span class="s1">tags </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">tags</span><span class="s2">,</span>
                <span class="s1">platformTags </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">platformTags</span><span class="s2">;</span>

            <span class="s0">if </span><span class="s2">(</span><span class="s1">tags</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">tags </span><span class="s0">instanceof </span><span class="s1">Array</span><span class="s2">) {</span>
                    <span class="s0">for </span><span class="s2">(</span><span class="s0">var </span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">tags</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                        <span class="s1">platformTags</span><span class="s2">[</span><span class="s1">tags</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] = </span><span class="s0">true</span><span class="s2">;</span>
                    }
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">platformTags</span><span class="s2">, </span><span class="s1">tags</span><span class="s2">);</span>
                }

                <span class="s4">// re-apply the query parameters, so that the params as specified</span>
                // in the url always has highest priority
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">platformTags</span><span class="s2">, </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">loadPlatformsParam</span><span class="s2">());</span>
            }

            <span class="s4">// Convert all assets into Assets</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">js </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">processAssets</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">js</span><span class="s2">, </span><span class="s3">'js'</span><span class="s2">);</span>
            <span class="s0">this</span><span class="s2">.</span><span class="s1">css </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">processAssets</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">css</span><span class="s2">, </span><span class="s3">'css'</span><span class="s2">);</span>
        };

        <span class="s1">Manifest</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= {</span>
            <span class="s1">processAsset</span><span class="s2">:  </span><span class="s0">function</span><span class="s2">(</span><span class="s1">assetConfig</span><span class="s2">, </span><span class="s1">type</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">processedAsset </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Asset</span><span class="s2">({</span>
                    <span class="s1">manifest</span><span class="s2">: </span><span class="s0">this</span><span class="s2">,</span>
                    <span class="s1">assetConfig</span><span class="s2">: </span><span class="s1">assetConfig</span><span class="s2">,</span>
                    <span class="s1">type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">,</span>
                    <span class="s1">loadFromCache</span><span class="s2">: </span><span class="s0">this</span><span class="s2">.</span><span class="s1">assetCache</span>
                <span class="s2">});</span>
                <span class="s0">this</span><span class="s2">.</span><span class="s1">assetMap</span><span class="s2">[</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">] = </span><span class="s1">processedAsset</span><span class="s2">;</span>
                <span class="s0">return </span><span class="s1">processedAsset</span><span class="s2">;</span>
            },

            <span class="s1">processAssets</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">assets</span><span class="s2">, </span><span class="s1">type</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">results </span><span class="s2">= [],</span>
                    <span class="s1">ln </span><span class="s2">= </span><span class="s1">assets</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                    <span class="s1">i</span><span class="s2">, </span><span class="s1">assetConfig</span><span class="s2">;</span>

                <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">ln</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">assetConfig </span><span class="s2">= </span><span class="s1">assets</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                    <span class="s1">results</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">processAsset</span><span class="s2">(</span><span class="s1">assetConfig</span><span class="s2">, </span><span class="s1">type</span><span class="s2">));</span>
                }

                <span class="s0">return </span><span class="s1">results</span><span class="s2">;</span>
            },

            <span class="s1">useAppCache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s0">return true</span><span class="s2">;</span>
            },

            <span class="s4">// Concatenate all assets for easy access</span>
            <span class="s1">getAssets</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">return this</span><span class="s2">.</span><span class="s1">css</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">js</span><span class="s2">);</span>
            },

            <span class="s1">getAsset</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
                <span class="s0">return this</span><span class="s2">.</span><span class="s1">assetMap</span><span class="s2">[</span><span class="s1">path</span><span class="s2">];</span>
            },

            <span class="s1">shouldCache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s0">return this</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">&amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">cacheEnabled</span><span class="s2">;</span>
            },

            <span class="s1">cache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">content</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">()) {</span>
                    <span class="s1">LocalStorage</span><span class="s2">.</span><span class="s1">setAsset</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">key</span><span class="s2">, </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">content </span><span class="s2">|| </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">));</span>
                }
                <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Manifest caching is disabled.&quot;</span><span class="s2">);</span>
                }
            },

            <span class="s1">is</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">) {</span>
                <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Testing Manifest: &quot; </span><span class="s2">+ </span><span class="s0">this</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">+ </span><span class="s3">&quot; VS &quot; </span><span class="s2">+  </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">);</span>
                <span class="s0">return this</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">=== </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">;</span>
            },

            <span class="s4">// Clear the manifest from local storage</span>
            <span class="s1">uncache</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s1">LocalStorage</span><span class="s2">.</span><span class="s1">setAsset</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">key</span><span class="s2">, </span><span class="s0">null</span><span class="s2">);</span>
            },

            <span class="s1">exportContent</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">({</span>
                    <span class="s1">loadOrderMap</span><span class="s2">: </span><span class="s0">this</span><span class="s2">.</span><span class="s1">loadOrderMap</span>
                <span class="s2">}, </span><span class="s0">this</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
            }
        };

        <span class="s4">/**</span>
         * Microloader
         * @type {Array}
         * @private
         */
        <span class="s0">var </span><span class="s1">_listeners </span><span class="s2">= [],</span>
        <span class="s1">_loaded </span><span class="s2">= </span><span class="s0">false</span><span class="s2">,</span>
        <span class="s1">Microloader </span><span class="s2">= {</span>
            <span class="s1">init</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s1">Ext</span><span class="s2">.</span><span class="s1">microloaded </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>

                <span class="s4">// data-app is in the dev template for an application and is also</span>
                // injected into the app my CMD for production
                // We use this to prefix localStorage cache to prevent collisions
                <span class="s0">var </span><span class="s1">microloaderElement </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">getElementById</span><span class="s2">(</span><span class="s3">'microloader'</span><span class="s2">);</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appId </span><span class="s2">= </span><span class="s1">microloaderElement </span><span class="s2">? </span><span class="s1">microloaderElement</span><span class="s2">.</span><span class="s1">getAttribute</span><span class="s2">(</span><span class="s3">'data-app'</span><span class="s2">) : </span><span class="s3">''</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">beforeLoad</span><span class="s2">) {</span>
                    <span class="s1">postProcessor </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">beforeLoad</span><span class="s2">(</span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">platformTags</span><span class="s2">);</span>
                }

                <span class="s0">var </span><span class="s1">readyHandler </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">_beforereadyhandler</span><span class="s2">;</span>

                <span class="s1">Ext</span><span class="s2">.</span><span class="s1">_beforereadyhandler </span><span class="s2">= </span><span class="s0">function </span><span class="s2">() {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">Boot </span><span class="s2">!== </span><span class="s1">Boot</span><span class="s2">) {</span>
                        <span class="s1">Ext</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">Boot</span><span class="s2">, </span><span class="s1">Boot</span><span class="s2">);</span>
                        <span class="s1">Ext</span><span class="s2">.</span><span class="s1">Boot </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">;</span>
                    }
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">readyHandler</span><span class="s2">) {</span>
                        <span class="s1">readyHandler</span><span class="s2">();</span>
                    }
                };
            },

            <span class="s1">applyCacheBuster</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">url</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">tstamp </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Date</span><span class="s2">().</span><span class="s1">getTime</span><span class="s2">(),</span>
                    <span class="s1">sep </span><span class="s2">= </span><span class="s1">url</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s3">'?'</span><span class="s2">) === -</span><span class="s3">1 </span><span class="s2">? </span><span class="s3">'?' </span><span class="s2">: </span><span class="s3">'&amp;'</span><span class="s2">,</span>
                    <span class="s1">progressive </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">progressive</span><span class="s2">,</span>
                    <span class="s1">serviceWorker </span><span class="s2">= </span><span class="s1">progressive </span><span class="s2">&amp;&amp; </span><span class="s1">progressive</span><span class="s2">.</span><span class="s1">serviceWorker</span><span class="s2">;</span>
                <span class="s0">if </span><span class="s2">(!</span><span class="s1">serviceWorker</span><span class="s2">) {</span>
                    <span class="s1">url </span><span class="s2">= </span><span class="s1">url </span><span class="s2">+ </span><span class="s1">sep </span><span class="s2">+ </span><span class="s3">&quot;_dc=&quot; </span><span class="s2">+ </span><span class="s1">tstamp</span><span class="s2">;</span>
                }
                <span class="s0">return </span><span class="s1">url</span><span class="s2">;</span>
            },

            <span class="s1">run</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">init</span><span class="s2">();</span>
                <span class="s0">var </span><span class="s1">manifest </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">manifest </span><span class="s2">=== </span><span class="s3">&quot;string&quot;</span><span class="s2">) {</span>
                    <span class="s0">var </span><span class="s1">extension </span><span class="s2">= </span><span class="s3">&quot;.json&quot;</span><span class="s2">,</span>
                        <span class="s1">url </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">extension</span><span class="s2">) === </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">extension</span><span class="s2">.</span><span class="s1">length</span>
                            <span class="s2">? </span><span class="s1">manifest</span>
                            <span class="s2">: </span><span class="s1">manifest </span><span class="s2">+ </span><span class="s3">&quot;.json&quot;</span><span class="s2">,</span>
                        <span class="s1">key </span><span class="s2">= </span><span class="s1">getStorageKey</span><span class="s2">(</span><span class="s1">url</span><span class="s2">),</span>
                        <span class="s1">content </span><span class="s2">= </span><span class="s1">LocalStorage</span><span class="s2">.</span><span class="s1">retrieveAsset</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>

                    <span class="s4">// Manifest found in local storage, use this for immediate boot except in PhantomJS environments for building.</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">content</span><span class="s2">) {</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Manifest file, '&quot; </span><span class="s2">+ </span><span class="s1">url </span><span class="s2">+ </span><span class="s3">&quot;', was found in Local Storage&quot;</span><span class="s2">);</span>
                        <span class="s1">manifest </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Manifest</span><span class="s2">({</span>
                            <span class="s1">url</span><span class="s2">: </span><span class="s1">url</span><span class="s2">,</span>
                            <span class="s1">content</span><span class="s2">: </span><span class="s1">content</span><span class="s2">,</span>
                            <span class="s1">cached</span><span class="s2">: </span><span class="s0">true</span>
                        <span class="s2">});</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">postProcessor</span><span class="s2">) {</span>
                            <span class="s1">postProcessor</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">);</span>
                        }
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">);</span>


                    <span class="s4">// Manifest is not in local storage. Fetch it from the server</span>
                    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Manifest file was not found in Local Storage, loading: &quot; </span><span class="s2">+ </span><span class="s1">url</span><span class="s2">);</span>

                        <span class="s0">if </span><span class="s2">(</span><span class="s1">location</span><span class="s2">.</span><span class="s1">href</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s3">'file:/'</span><span class="s2">) === </span><span class="s3">0</span><span class="s2">) {</span>
                            <span class="s1">Manifest</span><span class="s2">.</span><span class="s1">url </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">applyCacheBuster</span><span class="s2">(</span><span class="s1">url </span><span class="s2">+ </span><span class="s3">'p'</span><span class="s2">);</span>
                            <span class="s1">Boot</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">Manifest</span><span class="s2">.</span><span class="s1">url</span><span class="s2">);</span>
                        }
                        <span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">Manifest</span><span class="s2">.</span><span class="s1">url </span><span class="s2">= </span><span class="s1">url</span><span class="s2">;</span>
                            <span class="s1">Boot</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">applyCacheBuster</span><span class="s2">(</span><span class="s1">url</span><span class="s2">), </span><span class="s0">function</span><span class="s2">(</span><span class="s1">result</span><span class="s2">) {</span>
                                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">setManifest</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
                            });
                        }
                    }

                <span class="s4">// Embedded Manifest into JS file</span>
                <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Manifest was embedded into application javascript file&quot;</span><span class="s2">);</span>
                    <span class="s1">manifest </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Manifest</span><span class="s2">({</span>
                        <span class="s1">content</span><span class="s2">: </span><span class="s1">manifest</span>
                    <span class="s2">});</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">);</span>
                }
            },

            <span class="s4">/**</span>
             *
             * @param cfg
             */
            <span class="s1">setManifest</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">manifest </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Manifest</span><span class="s2">({</span>
                    <span class="s1">url</span><span class="s2">: </span><span class="s1">Manifest</span><span class="s2">.</span><span class="s1">url</span><span class="s2">,</span>
                    <span class="s1">content</span><span class="s2">: </span><span class="s1">cfg</span>
                <span class="s2">});</span>
                <span class="s1">manifest</span><span class="s2">.</span><span class="s1">cache</span><span class="s2">();</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">postProcessor</span><span class="s2">) {</span>
                    <span class="s1">postProcessor</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">);</span>
                }
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">);</span>
            },

            <span class="s4">/**</span>
             * @param {Manifest} manifest
             */
            <span class="s1">load</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">) {</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">urls </span><span class="s2">= [];</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">;</span>
                <span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">exportContent</span><span class="s2">();</span>
                <span class="s0">var </span><span class="s1">progressive </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">progressive</span><span class="s2">;</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">progressive </span><span class="s2">&amp;&amp; </span><span class="s1">progressive</span><span class="s2">.</span><span class="s1">serviceWorker</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s3">'serviceWorker' </span><span class="s0">in </span><span class="s1">navigator</span><span class="s2">) {</span>
                        <span class="s1">navigator</span><span class="s2">.</span><span class="s1">serviceWorker</span><span class="s2">.</span><span class="s1">register</span><span class="s2">(</span><span class="s3">'./' </span><span class="s2">+ </span><span class="s1">progressive</span><span class="s2">.</span><span class="s1">serviceWorker</span><span class="s2">);</span>
                        <span class="s1">Ext</span><span class="s2">.</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">config</span><span class="s2">.</span><span class="s1">disableCaching </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    }
                }
                
                <span class="s0">var </span><span class="s1">assets </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">getAssets</span><span class="s2">(),</span>
                    <span class="s1">cachedAssets </span><span class="s2">= [],</span>
                    <span class="s1">asset</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">include</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">;</span>

                <span class="s0">for </span><span class="s2">(</span><span class="s1">len </span><span class="s2">= </span><span class="s1">assets</span><span class="s2">.</span><span class="s1">length</span><span class="s2">, </span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">asset </span><span class="s2">= </span><span class="s1">assets</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                    <span class="s1">include </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">filterAsset</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">);</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">include</span><span class="s2">) {</span>
                        <span class="s4">// Asset is using the localStorage caching system</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">() &amp;&amp; </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">()) {</span>
                            <span class="s4">// Asset already has content from localStorage, instantly seed that into boot</span>
                            <span class="s0">if </span><span class="s2">(</span><span class="s1">asset</span><span class="s2">.</span><span class="s1">content</span><span class="s2">) {</span>
                                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; was found in local storage. No remote load for this file&quot;</span><span class="s2">);</span>
                                <span class="s1">entry </span><span class="s2">= </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">registerContent</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
                                <span class="s0">if </span><span class="s2">(</span><span class="s1">entry</span><span class="s2">.</span><span class="s1">evaluated</span><span class="s2">) {</span>
                                    <span class="s1">_warn</span><span class="s2">(</span><span class="s3">&quot;Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; was evaluated prior to local storage being consulted.&quot;</span><span class="s2">);</span>
                                }
                            <span class="s4">//load via AJAX and seed content into Boot</span>
                            <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
                                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; was NOT found in local storage. Adding to load queue&quot;</span><span class="s2">);</span>
                                <span class="s1">cachedAssets</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">);</span>
                            }
                        }
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">urls</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">);</span>
                        <span class="s1">Boot</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">[</span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">] = </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">({</span><span class="s1">type</span><span class="s2">: </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">type</span><span class="s2">}, </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">);</span>
                    }
                }

                <span class="s4">// If any assets are using the caching system and do not have local versions load them first via AJAX</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">cachedAssets</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingCachedAssets </span><span class="s2">= </span><span class="s1">cachedAssets</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                    <span class="s0">while </span><span class="s2">(</span><span class="s1">cachedAssets</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                        <span class="s1">asset </span><span class="s2">= </span><span class="s1">cachedAssets</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Preloading/Fetching Cached Assets from: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">);</span>
                        <span class="s1">Boot</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, (</span><span class="s0">function</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">) {</span>
                            <span class="s0">return function</span><span class="s2">(</span><span class="s1">result</span><span class="s2">) {</span>
                                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onCachedAssetLoaded</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">, </span><span class="s1">result</span><span class="s2">);</span>
                            }
                        })(<span class="s1">asset</span><span class="s2">));</span>
                    }
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onCachedAssetsReady</span><span class="s2">();</span>
                }
            },

            <span class="s4">// Load the asset and seed its content into Boot to be evaluated in sequence</span>
            <span class="s1">onCachedAssetLoaded</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">asset</span><span class="s2">, </span><span class="s1">result</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">checksum</span><span class="s2">;</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">parseResult</span><span class="s2">(</span><span class="s1">result</span><span class="s2">);</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingCachedAssets</span><span class="s2">--;</span>

                <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
                    <span class="s1">checksum </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checksum</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">, </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">);</span>
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">checksum</span><span class="s2">) {</span>
                        <span class="s1">_warn</span><span class="s2">(</span><span class="s3">&quot;Cached Asset '&quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot;' has failed checksum. This asset will be uncached for future loading&quot;</span><span class="s2">);</span>

                        <span class="s4">// Un cache this asset so it is loaded next time</span>
                        <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                    }

                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Checksum for Cached Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; is &quot; </span><span class="s2">+ </span><span class="s1">checksum</span><span class="s2">);</span>
                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">registerContent</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
                    <span class="s1">asset</span><span class="s2">.</span><span class="s1">updateContent</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
                    <span class="s1">asset</span><span class="s2">.</span><span class="s1">cache</span><span class="s2">();</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">_warn</span><span class="s2">(</span><span class="s3">&quot;There was an error pre-loading the asset '&quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot;'. This asset will be uncached for future loading&quot;</span><span class="s2">);</span>

                    <span class="s4">// Un cache this asset so it is loaded next time</span>
                    <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                }

                <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingCachedAssets </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) {</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onCachedAssetsReady</span><span class="s2">();</span>
                }
            },

            <span class="s1">onCachedAssetsReady</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(){</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">load</span><span class="s2">({</span>
                    <span class="s1">url</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">urls</span><span class="s2">,</span>
                    <span class="s1">loadOrder</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">loadOrder</span><span class="s2">,</span>
                    <span class="s1">loadOrderMap</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">loadOrderMap</span><span class="s2">,</span>
                    <span class="s1">sequential</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>
                    <span class="s1">success</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllAssetsReady</span><span class="s2">,</span>
                    <span class="s1">failure</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllAssetsReady</span>
                <span class="s2">});</span>
            },

            <span class="s1">onAllAssetsReady</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s1">_loaded </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">notify</span><span class="s2">();</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">navigator</span><span class="s2">.</span><span class="s1">onLine </span><span class="s2">!== </span><span class="s0">false</span><span class="s2">) {</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Application is online, checking for updates&quot;</span><span class="s2">);</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checkAllUpdates</span><span class="s2">();</span>
                }
                <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Application is offline, adding online listener to check for updates&quot;</span><span class="s2">);</span>
                    <span class="s0">if</span><span class="s2">(</span><span class="s1">window</span><span class="s2">[</span><span class="s3">'addEventListener'</span><span class="s2">]) {</span>
                        <span class="s1">window</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s3">'online'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checkAllUpdates</span><span class="s2">, </span><span class="s0">false</span><span class="s2">);</span>
                    }
                }
            },

            <span class="s1">onMicroloaderReady</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">listener</span><span class="s2">) {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">_loaded</span><span class="s2">) {</span>
                    <span class="s1">listener</span><span class="s2">();</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">_listeners</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">listener</span><span class="s2">);</span>
                }
            },

            <span class="s4">/**</span>
             * @private
             */
            <span class="s1">notify</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;notifying microloader ready listeners.&quot;</span><span class="s2">);</span>
                <span class="s0">var </span><span class="s1">listener</span><span class="s2">;</span>
                <span class="s0">while</span><span class="s2">((</span><span class="s1">listener </span><span class="s2">= </span><span class="s1">_listeners</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">())) {</span>
                    <span class="s1">listener</span><span class="s2">();</span>
                }
            },

            <span class="s4">// Delta patches content</span>
            <span class="s1">patch</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">content</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">output </span><span class="s2">= [],</span>
                    <span class="s1">chunk</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">ln</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">delta</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) {</span>
                    <span class="s0">return </span><span class="s1">content</span><span class="s2">;</span>
                }

                <span class="s0">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s3">0</span><span class="s2">,</span><span class="s1">ln </span><span class="s2">= </span><span class="s1">delta</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">ln</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                    <span class="s1">chunk </span><span class="s2">= </span><span class="s1">delta</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>

                    <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">chunk </span><span class="s2">=== </span><span class="s3">'number'</span><span class="s2">) {</span>
                        <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">content</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s1">chunk</span><span class="s2">, </span><span class="s1">chunk </span><span class="s2">+ </span><span class="s1">delta</span><span class="s2">[++</span><span class="s1">i</span><span class="s2">]));</span>
                    }
                    <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">chunk</span><span class="s2">);</span>
                    }
                }

                <span class="s0">return </span><span class="s1">output</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">''</span><span class="s2">);</span>
            },

            <span class="s1">checkAllUpdates</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Checking for All Updates&quot;</span><span class="s2">);</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">window</span><span class="s2">[</span><span class="s3">'removeEventListener'</span><span class="s2">]) {</span>
                    <span class="s1">window</span><span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">(</span><span class="s3">'online'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checkAllUpdates</span><span class="s2">, </span><span class="s0">false</span><span class="s2">);</span>
                }

                <span class="s0">if</span><span class="s2">(</span><span class="s1">_cache</span><span class="s2">) {</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checkForAppCacheUpdate</span><span class="s2">();</span>
                }

                <span class="s4">// Manifest came from a cached instance, check for updates</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">fromCache</span><span class="s2">) {</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checkForUpdates</span><span class="s2">();</span>
                }
            },

            <span class="s1">checkForAppCacheUpdate</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Checking App Cache status&quot;</span><span class="s2">);</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">UPDATEREADY </span><span class="s2">|| </span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">OBSOLETE</span><span class="s2">) {</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;App Cache is already in an updated&quot;</span><span class="s2">);</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">= </span><span class="s3">'updated'</span><span class="s2">;</span>
                } <span class="s0">else if </span><span class="s2">(</span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">status </span><span class="s2">!== </span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">IDLE </span><span class="s2">&amp;&amp; </span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">status </span><span class="s2">!== </span><span class="s1">_cache</span><span class="s2">.</span><span class="s1">UNCACHED</span><span class="s2">) {</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;App Cache is checking or downloading updates, adding listeners&quot;</span><span class="s2">);</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">= </span><span class="s3">'checking'</span><span class="s2">;</span>
                    <span class="s1">_cache</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s3">'error'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAppCacheError</span><span class="s2">);</span>
                    <span class="s1">_cache</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s3">'noupdate'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAppCacheNotUpdated</span><span class="s2">);</span>
                    <span class="s1">_cache</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s3">'cached'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAppCacheNotUpdated</span><span class="s2">);</span>
                    <span class="s1">_cache</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s3">'updateready'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAppCacheReady</span><span class="s2">);</span>
                    <span class="s1">_cache</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">(</span><span class="s3">'obsolete'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAppCacheObsolete</span><span class="s2">);</span>
                } <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;App Cache is current or uncached&quot;</span><span class="s2">);</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">= </span><span class="s3">'current'</span><span class="s2">;</span>
                }
            },

            <span class="s1">checkForUpdates</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s4">// Fetch the Latest Manifest from the server</span>
                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Checking for updates at: &quot; </span><span class="s2">+ </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">url</span><span class="s2">);</span>
                <span class="s1">Boot</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">applyCacheBuster</span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">url</span><span class="s2">), </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onUpdatedManifestLoaded</span><span class="s2">);</span>
            },

            <span class="s1">onAppCacheError</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
                <span class="s1">_warn</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">message</span><span class="s2">);</span>

                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">= </span><span class="s3">'error'</span><span class="s2">;</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">notifyUpdateReady</span><span class="s2">();</span>
            },

            <span class="s1">onAppCacheReady</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s1">_cache</span><span class="s2">.</span><span class="s1">swapCache</span><span class="s2">();</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheUpdated</span><span class="s2">();</span>
            },

            <span class="s1">onAppCacheObsolete</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheUpdated</span><span class="s2">();</span>
            },

            <span class="s1">appCacheUpdated</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;App Cache Updated&quot;</span><span class="s2">);</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">= </span><span class="s3">'updated'</span><span class="s2">;</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">notifyUpdateReady</span><span class="s2">();</span>
            },

            <span class="s1">onAppCacheNotUpdated</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;App Cache Not Updated Callback&quot;</span><span class="s2">);</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">= </span><span class="s3">'current'</span><span class="s2">;</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">notifyUpdateReady</span><span class="s2">();</span>
            },


            <span class="s1">filterAsset</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">cfg </span><span class="s2">= (</span><span class="s1">asset </span><span class="s2">&amp;&amp; </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">) || {};</span>
                <span class="s0">if</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">platform </span><span class="s2">|| </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">exclude</span><span class="s2">) {</span>
                    <span class="s0">return </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">filterPlatform</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">platform</span><span class="s2">, </span><span class="s1">cfg</span><span class="s2">.</span><span class="s1">exclude</span><span class="s2">);</span>
                }
                <span class="s0">return true</span><span class="s2">;</span>
            },

            <span class="s1">onUpdatedManifestLoaded</span><span class="s2">: </span><span class="s0">function </span><span class="s2">(</span><span class="s1">result</span><span class="s2">) {</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">parseResult</span><span class="s2">(</span><span class="s1">result</span><span class="s2">);</span>

                <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
                    <span class="s0">var </span><span class="s1">currentAssets</span><span class="s2">, </span><span class="s1">newAssets</span><span class="s2">, </span><span class="s1">currentAsset</span><span class="s2">, </span><span class="s1">newAsset</span><span class="s2">, </span><span class="s1">prop</span><span class="s2">,</span>
                        <span class="s1">assets</span><span class="s2">, </span><span class="s1">deltas</span><span class="s2">, </span><span class="s1">deltaPath</span><span class="s2">, </span><span class="s1">include</span><span class="s2">,</span>
                        <span class="s1">updatingAssets </span><span class="s2">= [],</span>
                        <span class="s1">manifest </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Manifest</span><span class="s2">({</span>
                            <span class="s1">url</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">url</span><span class="s2">,</span>
                            <span class="s1">content</span><span class="s2">: </span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">,</span>
                            <span class="s1">assetCache</span><span class="s2">: </span><span class="s0">false</span>
                        <span class="s2">});</span>

                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingUpdatingAssets </span><span class="s2">= </span><span class="s3">0</span><span class="s2">;</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssets </span><span class="s2">= [];</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">removedAssets </span><span class="s2">= [];</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest </span><span class="s2">= </span><span class="s0">null</span><span class="s2">;</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssetsReady </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>

                    <span class="s4">// If the updated manifest has turned off caching we need to clear out all local storage</span>
                    // and trigger a appupdate as all content is now uncached
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">()) {</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;New Manifest has caching disabled, clearing out any private storage&quot;</span><span class="s2">);</span>

                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">;</span>
                        <span class="s1">LocalStorage</span><span class="s2">.</span><span class="s1">clearAllPrivate</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">);</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllUpdatedAssetsReady</span><span class="s2">();</span>
                        <span class="s0">return</span><span class="s2">;</span>
                    }

                    <span class="s4">// Manifest itself has changed</span>
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s1">manifest</span><span class="s2">)) {</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">;</span>

                        <span class="s1">currentAssets </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">getAssets</span><span class="s2">();</span>
                        <span class="s1">newAssets </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">getAssets</span><span class="s2">();</span>

                        <span class="s4">// Look through new assets for assets that do not exist or assets that have different versions</span>
                        <span class="s0">for </span><span class="s2">(</span><span class="s1">prop </span><span class="s0">in </span><span class="s1">newAssets</span><span class="s2">) {</span>
                            <span class="s1">newAsset </span><span class="s2">= </span><span class="s1">newAssets</span><span class="s2">[</span><span class="s1">prop</span><span class="s2">];</span>
                            <span class="s1">currentAsset </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">getAsset</span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">);</span>
                            <span class="s1">include </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">filterAsset</span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">);</span>

                            <span class="s0">if </span><span class="s2">(</span><span class="s1">include </span><span class="s2">&amp;&amp; (!</span><span class="s1">currentAsset </span><span class="s2">|| (</span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">() &amp;&amp; (!</span><span class="s1">currentAsset</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">))))) {</span>
                                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;New/Updated Version of Asset: &quot; </span><span class="s2">+ </span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; was found in new manifest&quot;</span><span class="s2">);</span>
                                <span class="s1">updatingAssets</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span><span class="s1">_new</span><span class="s2">: </span><span class="s1">newAsset</span><span class="s2">, </span><span class="s1">_current</span><span class="s2">: </span><span class="s1">currentAsset</span><span class="s2">});</span>
                            }
                        }

                        <span class="s4">// Look through current assets for stale/old assets that have been removed</span>
                        <span class="s0">for </span><span class="s2">(</span><span class="s1">prop </span><span class="s0">in </span><span class="s1">currentAssets</span><span class="s2">) {</span>
                            <span class="s1">currentAsset </span><span class="s2">= </span><span class="s1">currentAssets</span><span class="s2">[</span><span class="s1">prop</span><span class="s2">];</span>
                            <span class="s1">newAsset </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">getAsset</span><span class="s2">(</span><span class="s1">currentAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">);</span>

                            <span class="s4">//New version of this asset has been filtered out</span>
                            <span class="s1">include </span><span class="s2">= !</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">filterAsset</span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">);</span>

                            <span class="s0">if </span><span class="s2">(!</span><span class="s1">include </span><span class="s2">|| !</span><span class="s1">newAsset </span><span class="s2">|| (</span><span class="s1">currentAsset</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">() &amp;&amp; !</span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">shouldCache</span><span class="s2">())) {</span>
                                    <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Asset: &quot; </span><span class="s2">+ </span><span class="s1">currentAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; was not found in new manifest, has been filtered out or has been switched to not cache. Marked for removal&quot;</span><span class="s2">);</span>
                                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">removedAssets</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">currentAsset</span><span class="s2">);</span>
                            }
                        }

                        <span class="s4">// Loop through all assets that need updating</span>
                        <span class="s0">if </span><span class="s2">(</span><span class="s1">updatingAssets</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                            <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingUpdatingAssets </span><span class="s2">= </span><span class="s1">updatingAssets</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                            <span class="s0">while </span><span class="s2">(</span><span class="s1">updatingAssets</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                                <span class="s1">assets </span><span class="s2">= </span><span class="s1">updatingAssets</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                                <span class="s1">newAsset </span><span class="s2">= </span><span class="s1">assets</span><span class="s2">.</span><span class="s1">_new</span><span class="s2">;</span>
                                <span class="s1">currentAsset </span><span class="s2">= </span><span class="s1">assets</span><span class="s2">.</span><span class="s1">_current</span><span class="s2">;</span>

                                <span class="s4">// Full Updates will simply download the file and replace its current content</span>
                                <span class="s0">if </span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">update </span><span class="s2">=== </span><span class="s3">&quot;full&quot; </span><span class="s2">|| !</span><span class="s1">currentAsset</span><span class="s2">) {</span>

                                    <span class="s0">if </span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">update </span><span class="s2">=== </span><span class="s3">&quot;delta&quot;</span><span class="s2">) {</span>
                                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Delta updated asset found without current asset available: &quot; </span><span class="s2">+ </span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; fetching full file&quot;</span><span class="s2">);</span>
                                    } <span class="s0">else </span><span class="s2">{</span>
                                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Full update found for: &quot; </span><span class="s2">+ </span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; fetching&quot;</span><span class="s2">);</span>
                                    }

                                    <span class="s4">// Load the asset and cache its  its content into Boot to be evaluated in sequence</span>
                                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, (</span><span class="s0">function </span><span class="s2">(</span><span class="s1">asset</span><span class="s2">) {</span>
                                            <span class="s0">return function </span><span class="s2">(</span><span class="s1">result</span><span class="s2">) {</span>
                                                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onFullAssetUpdateLoaded</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">, </span><span class="s1">result</span><span class="s2">)</span>
                                            };
                                        }(<span class="s1">newAsset</span><span class="s2">))</span>
                                    );

                                    <span class="s4">// Delta updates will be given a delta patch</span>
                                <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">update </span><span class="s2">=== </span><span class="s3">&quot;delta&quot;</span><span class="s2">) {</span>
                                    <span class="s1">deltas </span><span class="s2">= </span><span class="s1">manifest</span><span class="s2">.</span><span class="s1">deltas</span><span class="s2">;</span>
                                    <span class="s1">deltaPath </span><span class="s2">= </span><span class="s1">deltas </span><span class="s2">+ </span><span class="s3">&quot;/&quot; </span><span class="s2">+ </span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot;/&quot; </span><span class="s2">+ </span><span class="s1">currentAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">+ </span><span class="s3">&quot;.json&quot;</span><span class="s2">;</span>
                                    <span class="s4">// Fetch the Delta Patch and update the contents of the asset</span>
                                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Delta update found for: &quot; </span><span class="s2">+ </span><span class="s1">newAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; fetching&quot;</span><span class="s2">);</span>
                                    <span class="s1">Boot</span><span class="s2">.</span><span class="s1">fetch</span><span class="s2">(</span><span class="s1">deltaPath</span><span class="s2">,</span>
                                        (<span class="s0">function </span><span class="s2">(</span><span class="s1">asset</span><span class="s2">, </span><span class="s1">oldAsset</span><span class="s2">) {</span>
                                            <span class="s0">return function </span><span class="s2">(</span><span class="s1">result</span><span class="s2">) {</span>
                                                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onDeltaAssetUpdateLoaded</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">, </span><span class="s1">oldAsset</span><span class="s2">, </span><span class="s1">result</span><span class="s2">)</span>
                                            };
                                        }(<span class="s1">newAsset</span><span class="s2">, </span><span class="s1">currentAsset</span><span class="s2">))</span>
                                    );
                                }
                            }
                        } <span class="s0">else </span><span class="s2">{</span>
                                <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;No Assets needed updating&quot;</span><span class="s2">);</span>
                            <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllUpdatedAssetsReady</span><span class="s2">();</span>
                        }
                    } <span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Manifest files have matching hash's&quot;</span><span class="s2">);</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllUpdatedAssetsReady</span><span class="s2">();</span>
                    }
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">_warn</span><span class="s2">(</span><span class="s3">&quot;Error loading manifest file to check for updates&quot;</span><span class="s2">);</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllUpdatedAssetsReady</span><span class="s2">();</span>
                }
            },

            <span class="s1">onFullAssetUpdateLoaded</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">, </span><span class="s1">result</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">checksum</span><span class="s2">;</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">parseResult</span><span class="s2">(</span><span class="s1">result</span><span class="s2">);</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingUpdatingAssets</span><span class="s2">--;</span>

                <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
                    <span class="s1">checksum </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checksum</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">, </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">);</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Checksum for Full asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; is &quot; </span><span class="s2">+ </span><span class="s1">checksum</span><span class="s2">);</span>
                    <span class="s0">if </span><span class="s2">(!</span><span class="s1">checksum</span><span class="s2">) {</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Full Update Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; has failed checksum. This asset will be uncached for future loading&quot;</span><span class="s2">);</span>

                        <span class="s4">// uncache this asset as there is a new version somewhere that has not been loaded.</span>
                        <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                    } <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">asset</span><span class="s2">.</span><span class="s1">updateContent</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssets</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">);</span>
                    }
                } <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Error loading file at&quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot;. This asset will be uncached for future loading&quot;</span><span class="s2">);</span>

                    <span class="s4">// uncache this asset as there is a new version somewhere that has not been loaded.</span>
                    <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                }

                <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingUpdatingAssets </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) {</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllUpdatedAssetsReady</span><span class="s2">();</span>
                }
            },

            <span class="s1">onDeltaAssetUpdateLoaded</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">, </span><span class="s1">oldAsset</span><span class="s2">, </span><span class="s1">result</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">json</span><span class="s2">, </span><span class="s1">checksum</span><span class="s2">, </span><span class="s1">content</span><span class="s2">;</span>
                <span class="s1">result </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">parseResult</span><span class="s2">(</span><span class="s1">result</span><span class="s2">);</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingUpdatingAssets</span><span class="s2">--;</span>

                <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Delta patch loaded successfully, patching content&quot;</span><span class="s2">);</span>
                    <span class="s0">try </span><span class="s2">{</span>
                        <span class="s1">json </span><span class="s2">= </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">);</span>
                        <span class="s1">content </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">patch</span><span class="s2">(</span><span class="s1">oldAsset</span><span class="s2">.</span><span class="s1">content</span><span class="s2">, </span><span class="s1">json</span><span class="s2">);</span>
                        <span class="s1">checksum </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">checksum</span><span class="s2">(</span><span class="s1">content</span><span class="s2">, </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash</span><span class="s2">);</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Checksum for Delta Patched asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; is &quot; </span><span class="s2">+ </span><span class="s1">checksum</span><span class="s2">);</span>
                        <span class="s0">if </span><span class="s2">(!</span><span class="s1">checksum</span><span class="s2">) {</span>
                                <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Delta Update Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; has failed checksum. This asset will be uncached for future loading&quot;</span><span class="s2">);</span>

                            <span class="s4">// uncache this asset as there is a new version somewhere that has not been loaded.</span>
                            <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                        } <span class="s0">else </span><span class="s2">{</span>
                            <span class="s1">asset</span><span class="s2">.</span><span class="s1">updateContent</span><span class="s2">(</span><span class="s1">content</span><span class="s2">);</span>
                            <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssets</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">asset</span><span class="s2">);</span>
                        }
                    } <span class="s0">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
                        <span class="s1">_warn</span><span class="s2">(</span><span class="s3">&quot;Error parsing delta patch for &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; with hash &quot; </span><span class="s2">+ </span><span class="s1">oldAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">+ </span><span class="s3">&quot; . This asset will be uncached for future loading&quot;</span><span class="s2">);</span>
                        <span class="s4">// uncache this asset as there is a new version somewhere that has not been loaded.</span>
                        <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                    }
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">_warn</span><span class="s2">(</span><span class="s3">&quot;Error loading delta patch for &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; with hash &quot; </span><span class="s2">+ </span><span class="s1">oldAsset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">hash </span><span class="s2">+ </span><span class="s3">&quot; . This asset will be uncached for future loading&quot;</span><span class="s2">);</span>

                    <span class="s4">// uncache this asset as there is a new version somewhere that has not been loaded.</span>
                    <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                }
                <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">remainingUpdatingAssets </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) {</span>
                    <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">onAllUpdatedAssetsReady</span><span class="s2">();</span>
                }
            },

            <span class="s4">//TODO: Make this all transaction based to allow for reverting if quota is exceeded</span>
            <span class="s1">onAllUpdatedAssetsReady</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s0">var </span><span class="s1">asset</span><span class="s2">;</span>
                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssetsReady </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest</span><span class="s2">) {</span>
                    <span class="s0">while </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">removedAssets</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                        <span class="s1">asset </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">removedAssets</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; was removed, un-caching&quot;</span><span class="s2">);</span>
                        <span class="s1">asset</span><span class="s2">.</span><span class="s1">uncache</span><span class="s2">();</span>
                    }

                    <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest</span><span class="s2">) {</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Manifest was updated, re-caching&quot;</span><span class="s2">);</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest</span><span class="s2">.</span><span class="s1">cache</span><span class="s2">();</span>
                    }

                    <span class="s0">while </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssets</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">) {</span>
                        <span class="s1">asset </span><span class="s2">= </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssets</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;Asset: &quot; </span><span class="s2">+ </span><span class="s1">asset</span><span class="s2">.</span><span class="s1">assetConfig</span><span class="s2">.</span><span class="s1">path </span><span class="s2">+ </span><span class="s3">&quot; was updated, re-caching&quot;</span><span class="s2">);</span>
                        <span class="s1">asset</span><span class="s2">.</span><span class="s1">cache</span><span class="s2">();</span>
                    }

                }

                <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">notifyUpdateReady</span><span class="s2">();</span>
            },

            <span class="s1">notifyUpdateReady</span><span class="s2">: </span><span class="s0">function </span><span class="s2">() {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">!== </span><span class="s3">'checking' </span><span class="s2">&amp;&amp; </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedAssetsReady</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">=== </span><span class="s3">'updated' </span><span class="s2">|| </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest</span><span class="s2">) {</span>
                            <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;There was an update here you will want to reload the app, trigger an event&quot;</span><span class="s2">);</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appUpdate </span><span class="s2">= {</span>
                            <span class="s1">updated</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>
                            <span class="s1">app</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appCacheState </span><span class="s2">=== </span><span class="s3">'updated'</span><span class="s2">,</span>
                            <span class="s1">manifest</span><span class="s2">: </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest </span><span class="s2">&amp;&amp; </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">updatedManifest</span><span class="s2">.</span><span class="s1">exportContent</span><span class="s2">()</span>
                        };

                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">fireAppUpdate</span><span class="s2">();</span>
                    }
                    <span class="s0">else </span><span class="s2">{</span>
                        <span class="s1">_debug</span><span class="s2">(</span><span class="s3">&quot;AppCache and LocalStorage Cache are current, no updating needed&quot;</span><span class="s2">);</span>
                        <span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appUpdate </span><span class="s2">= {};</span>
                    }
                }
            },

            <span class="s1">fireAppUpdate</span><span class="s2">: </span><span class="s0">function</span><span class="s2">() {</span>
                <span class="s0">if </span><span class="s2">(</span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">GlobalEvents</span><span class="s2">) {</span>
                    <span class="s4">// We defer dispatching this event slightly in order to let the application finish loading</span>
                    // as we are still very early in the lifecycle
                    <span class="s1">Ext</span><span class="s2">.</span><span class="s1">defer</span><span class="s2">(</span><span class="s0">function</span><span class="s2">() {</span>
                        <span class="s1">Ext</span><span class="s2">.</span><span class="s1">GlobalEvents</span><span class="s2">.</span><span class="s1">fireEvent</span><span class="s2">(</span><span class="s3">'appupdate'</span><span class="s2">, </span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">appUpdate</span><span class="s2">);</span>
                    }, <span class="s3">1000</span><span class="s2">);</span>
                }
            },

            <span class="s1">checksum</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">content</span><span class="s2">, </span><span class="s1">hash</span><span class="s2">) {</span>
                <span class="s0">if</span><span class="s2">(!</span><span class="s1">content </span><span class="s2">|| !</span><span class="s1">hash</span><span class="s2">) {</span>
                    <span class="s0">return false</span><span class="s2">;</span>
                }

                <span class="s0">var </span><span class="s1">passed </span><span class="s2">= </span><span class="s0">true</span><span class="s2">,</span>
                    <span class="s1">hashLn </span><span class="s2">= </span><span class="s1">hash</span><span class="s2">.</span><span class="s1">length</span><span class="s2">,</span>
                    <span class="s1">checksumType </span><span class="s2">= </span><span class="s1">content</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s2">);</span>

                <span class="s0">if </span><span class="s2">(</span><span class="s1">checksumType </span><span class="s2">== </span><span class="s3">'/'</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">content</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">2</span><span class="s2">, </span><span class="s1">hashLn </span><span class="s2">+ </span><span class="s3">2</span><span class="s2">) !== </span><span class="s1">hash</span><span class="s2">) {</span>
                        <span class="s1">passed </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    }
                } <span class="s0">else if </span><span class="s2">(</span><span class="s1">checksumType </span><span class="s2">== </span><span class="s3">'f'</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">content</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">10</span><span class="s2">, </span><span class="s1">hashLn </span><span class="s2">+ </span><span class="s3">10</span><span class="s2">) !== </span><span class="s1">hash</span><span class="s2">) {</span>
                        <span class="s1">passed </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    }
                } <span class="s0">else if </span><span class="s2">(</span><span class="s1">checksumType </span><span class="s2">== </span><span class="s3">'.'</span><span class="s2">) {</span>
                    <span class="s0">if </span><span class="s2">(</span><span class="s1">content</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s3">1</span><span class="s2">, </span><span class="s1">hashLn </span><span class="s2">+ </span><span class="s3">1</span><span class="s2">) !== </span><span class="s1">hash</span><span class="s2">) {</span>
                        <span class="s1">passed </span><span class="s2">= </span><span class="s0">false</span><span class="s2">;</span>
                    }
                }
                <span class="s0">return </span><span class="s1">passed</span><span class="s2">;</span>
            },
            <span class="s1">parseResult</span><span class="s2">: </span><span class="s0">function</span><span class="s2">(</span><span class="s1">result</span><span class="s2">) {</span>
                <span class="s0">var </span><span class="s1">rst </span><span class="s2">= {};</span>
                <span class="s0">if </span><span class="s2">((</span><span class="s1">result</span><span class="s2">.</span><span class="s1">exception </span><span class="s2">|| </span><span class="s1">result</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s3">0</span><span class="s2">) &amp;&amp; !</span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">env</span><span class="s2">.</span><span class="s1">phantom</span><span class="s2">) {</span>
                    <span class="s1">rst</span><span class="s2">.</span><span class="s1">error </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                } <span class="s0">else if </span><span class="s2">((</span><span class="s1">result</span><span class="s2">.</span><span class="s1">status </span><span class="s2">&gt;= </span><span class="s3">200 </span><span class="s2">&amp;&amp; </span><span class="s1">result</span><span class="s2">.</span><span class="s1">status </span><span class="s2">&lt; </span><span class="s3">300</span><span class="s2">) || </span><span class="s1">result</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s3">304</span>
                    <span class="s2">|| </span><span class="s1">Boot</span><span class="s2">.</span><span class="s1">env</span><span class="s2">.</span><span class="s1">phantom</span>
                    <span class="s2">|| (</span><span class="s1">result</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s3">0 </span><span class="s2">&amp;&amp; </span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">0</span><span class="s2">)</span>
                ) {
                    <span class="s1">rst</span><span class="s2">.</span><span class="s1">content </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">content</span><span class="s2">;</span>
                } <span class="s0">else </span><span class="s2">{</span>
                    <span class="s1">rst</span><span class="s2">.</span><span class="s1">error </span><span class="s2">= </span><span class="s0">true</span><span class="s2">;</span>
                }
                <span class="s0">return </span><span class="s1">rst</span><span class="s2">;</span>
            }
        };

    <span class="s0">return </span><span class="s1">Microloader</span><span class="s2">;</span>
}());

<span class="s4">/**</span>
 * @type {String/Object}
 */
<span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">= </span><span class="s1">Ext</span><span class="s2">.</span><span class="s1">manifest </span><span class="s2">|| </span><span class="s3">&quot;bootstrap&quot;</span><span class="s2">;</span>

<span class="s1">Ext</span><span class="s2">.</span><span class="s1">Microloader</span><span class="s2">.</span><span class="s1">run</span><span class="s2">();</span>
</pre>
</body>
</html>